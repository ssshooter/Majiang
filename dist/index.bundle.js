/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./js/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./js/game.js":
/*!********************!*\
  !*** ./js/game.js ***!
  \********************/
/*! exports provided: Game */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Game\", function() { return Game; });\n/* harmony import */ var _model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./model */ \"./js/model.js\");\n/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./player */ \"./js/player.js\");\n/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui */ \"./js/ui.js\");\n/* harmony import */ var _util_hule__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./util/hule */ \"./js/util/hule.js\");\n/* harmony import */ var _util_xiangting__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util/xiangting */ \"./js/util/xiangting.js\");\n/*\n *  Game\n */\n// import { view } from \"./view\";\n\n\n\n\n\n\nconst Game = function() {\n  this._speed = 3\n  this._stop = false\n  this._timeout_id\n  this._callback\n\n  this._chang = {\n    title: new Date().toLocaleString(),\n    player: ['私', '下家', '対面', '上家'],\n    qijia: Math.floor(Math.random() * 4),\n    zhuangfeng: 0,\n    jushu: 0,\n    changbang: 0,\n    lizhibang: 0,\n    defen: [25000, 25000, 25000, 25000],\n    hongpai: { m: 1, p: 1, s: 1 },\n  }\n\n  this._player = [new _ui__WEBPACK_IMPORTED_MODULE_2__[\"UI\"](0)]\n  for (var id = 1; id < 4; id++) {\n    this._player[id] = new _player__WEBPACK_IMPORTED_MODULE_1__[\"Player\"](id)\n  }\n}\n\nGame.prototype.delay = function(callback, timeout) {\n  setTimeout(callback, this._speed == 0 ? 0 : timeout == null ? 500 : timeout)\n}\n\nGame.prototype.kaiju = function() {\n  this._paipu = {\n    title: this._chang.title,\n    player: this._chang.player.concat(),\n    qijia: this._chang.qijia,\n    log: [],\n  }\n\n  var data = []\n  for (var i = 0; i < 4; i++) {\n    data[i] = JSON.parse(\n      JSON.stringify({\n        player: this._paipu.player,\n        qijia: this._paipu.qijia,\n        hongpai: this._chang.hongpai,\n      })\n    )\n  }\n  this.notify_players('kaiju', data)\n\n  this.qipai()\n}\n\nGame.prototype.add_paipu = function(data) {\n  var log = this._paipu.log[this._paipu.log.length - 1]\n  log.push(data)\n}\n\nGame.prototype.player_id = function(lunban) {\n  return (this._chang.qijia + this._chang.jushu + lunban) % 4\n}\n\nGame.prototype.notify_players = function(type, data) {\n  var self = this\n\n  for (var l = 0; l < 4; l++) {\n    ;(function() {\n      var id = self.player_id(l)\n      var lb = l\n      setTimeout(function() {\n        self._player[id].action(type, data[lb])\n      }, 0)\n    })()\n  }\n}\n\nGame.prototype.call_players = function(type, data, timeout) {\n  var self = this\n\n  this._status = type\n\n  if (this._speed != 0 && timeout != null) {\n    if (\n      this._player.filter(function(p) {\n        return p instanceof _ui__WEBPACK_IMPORTED_MODULE_2__[\"UI\"]\n      }).length\n    )\n      timeout = 0\n  } else timeout = this._speed * 200\n\n  this._reply = []\n  this._timeout_id = setTimeout(function() {\n    self.next()\n  }, timeout)\n  for (var l = 0; l < 4; l++) {\n    ;(function() {\n      var id = self.player_id(l)\n      var lb = l\n      setTimeout(\n        function() {\n          self._player[id].action(type, data[lb], function(type, reply) {\n            self.reply(id, type || '', reply)\n          })\n        },\n        self._speed ? 20 : 0\n      )\n    })()\n  }\n}\n\nGame.prototype.reply = function(id, type, data) {\n  var self = this\n\n  this._reply[id] = { type: type, data: data }\n  if (\n    this._reply.filter(function(x) {\n      return x\n    }).length < 4\n  )\n    return\n  if (!this._timeout_id)\n    this._timeout_id = setTimeout(function() {\n      self.next()\n    }, 0)\n}\n\nGame.prototype.next = function() {\n  var self = this\n\n  this._timeout_id = null\n  if (\n    this._reply.filter(function(x) {\n      return x\n    }).length < 4\n  )\n    return\n  if (this._stop) return\n\n  if (this._status == 'zimo') this.reply_zimo()\n  else if (this._status == 'dapai') this.reply_dapai()\n  else if (this._status == 'fulou') this.reply_fulou()\n  else if (this._status == 'gang') this.reply_gang()\n  else if (this._status == 'gangzimo') this.reply_zimo()\n  else if (this._status == 'hule') this.reply_hule()\n  else if (this._status == 'pingju') this.reply_pingju()\n  else if (this._status == 'jieju') this.reply_jieju()\n}\n\nGame.prototype.reply_zimo = function() {\n  var self = this\n\n  var reply = this._reply[this.player_id(this._lunban)]\n\n  if (reply.type == 'pingju') {\n    this.delay(function() {\n      self.pingju('九種九牌')\n    }, 0)\n  } else if (reply.type == 'hule') {\n    this.say('zimo')\n    this.delay(function() {\n      self.hule()\n    })\n  } else if (reply.type == 'gang') {\n    this.say('gang')\n    this.delay(function() {\n      self.gang(reply.data)\n    })\n  } else if (reply.type == 'dapai') {\n    if (reply.data.match(/\\*$/)) {\n      this.say('lizhi')\n      this.delay(\n        function() {\n          self.dapai(reply.data)\n        },\n        this._speed < 3 ? 500 : this._speed * 200\n      )\n    } else this.dapai(reply.data)\n  }\n}\n\nGame.prototype.reply_dapai = function() {\n  var self = this\n\n  for (var i = 0; i < 4; i++) {\n    var lunban = (this._lunban + i) % 4\n    var reply = this._reply[this.player_id(lunban)]\n    if (reply.type == 'hule') {\n      ;(function() {\n        var lb = lunban\n        var delay = self._hule.length * 150\n        setTimeout(function() {\n          self.say('rong', lb)\n        }, delay)\n      })()\n      this._hule.push(lunban)\n    }\n  }\n  if (this._hule.length > 0) {\n    if (this._hule.length == 3)\n      this.delay(function() {\n        self.pingju('三家和')\n      }, 0)\n    else\n      this.delay(function() {\n        self.hule()\n      })\n    return\n  }\n\n  if (this._dapai.match(/\\*$/)) {\n    this._chang.defen[this.player_id(this._lunban)] -= 1000\n    this._chang.lizhibang++\n    this._view.chang.redraw()\n\n    if (\n      this._lizhi.filter(function(x) {\n        return x\n      }).length == 4\n    ) {\n      this._view.he[this._lunban].redraw()\n      this.delay(function() {\n        self.pingju('四家立直')\n      }, 0)\n      return\n    }\n  }\n\n  if (this._diyizimo && this._lunban == 3) {\n    this._diyizimo = false\n    if (this._dafengpai) {\n      this.delay(function() {\n        self.pingju('四風連打')\n      }, 0)\n      return\n    }\n  }\n\n  if (this._model.shan.baopai().length == 5) {\n    for (var l = 0; l < 4; l++) {\n      if (0 < this._gang[l] && this._gang[l] < 4) {\n        this.delay(function() {\n          self.pingju('四開槓')\n        }, 0)\n        return\n      }\n    }\n  }\n\n  for (var i = 0; i < 4; i++) {\n    var lunban = (this._lunban + i) % 4\n    var reply = this._reply[this.player_id(lunban)]\n    if (reply.type == 'fulou') {\n      var m = reply.data.replace(/0/g, '5')\n      if (m.match(/^[mpsz](\\d)\\1\\1\\1/)) {\n        this.say('gang', lunban)\n        this.delay(function() {\n          self.fulou(reply.data)\n        })\n        return\n      } else if (m.match(/^[mpsz](\\d)\\1\\1/)) {\n        this.say('peng', lunban)\n        this.delay(function() {\n          self.fulou(reply.data)\n        })\n        return\n      }\n    }\n  }\n  for (var i = 0; i < 4; i++) {\n    var lunban = (this._lunban + i) % 4\n    var reply = this._reply[this.player_id(lunban)]\n    if (reply.type == 'fulou') {\n      this.say('chi', lunban)\n      this.delay(function() {\n        self.fulou(reply.data)\n      })\n      return\n    }\n  }\n\n  this.zimo()\n}\n\nGame.prototype.reply_fulou = function() {\n  var self = this\n\n  if (this._fulou.match(/^[mpsz]\\d{4}/)) {\n    this._gang[this._lunban]++\n    this.gangzimo()\n    return\n  }\n\n  var reply = this._reply[this.player_id(this._lunban)]\n  if (reply.type == 'dapai') {\n    this.dapai(reply.data)\n  }\n}\n\nGame.prototype.reply_gang = function() {\n  var self = this\n\n  for (var i = 0; i < 4; i++) {\n    var lunban = (this._lunban + i) % 4\n    var reply = this._reply[this.player_id(lunban)]\n    if (reply.type == 'hule') {\n      ;(function() {\n        var lb = lunban\n        var delay = self._hule.length * 150\n        setTimeout(function() {\n          self.say('rong', lb)\n        }, delay)\n      })()\n      this._hule.push(lunban)\n    }\n  }\n  if (this._hule.length > 0) {\n    if (this._hule.length == 3)\n      this.delay(function() {\n        self.pingju('三家和')\n      }, 0)\n    else\n      this.delay(function() {\n        self.hule()\n      })\n    return\n  }\n\n  this.gangzimo()\n}\n\nGame.prototype.reply_hule = function() {\n  var self = this\n\n  this._view.jiesuan.hide()\n\n  if (this._hule.length > 0) {\n    this.delay(function() {\n      self.hule()\n    })\n  } else this.jiesuan()\n}\n\nGame.prototype.reply_pingju = function() {\n  this._view.jiesuan.hide()\n  this.jiesuan()\n}\n\nGame.prototype.reply_jieju = function() {\n  if (this._callback) this._callback()\n}\n\nGame.prototype.say = function(name, lunban) {\n  this.audio_play(name, lunban)\n  Majiang.View.Say.play(\n    name,\n    this.player_id(lunban == null ? this._lunban : lunban)\n  )\n}\n\nGame.prototype.audio_play = function(name, lunban) {\n  if (this._speed == 0) return\n  Majiang.Audio.play(\n    name,\n    this.player_id(lunban == null ? this._lunban : lunban)\n  )\n}\n\nGame.prototype.create_view = function(viewpoint) {\n  $('.jiezhang')\n    .removeClass('summary')\n    .hide()\n  $('.say').hide()\n  $('.menu').hide()\n\n  viewpoint = viewpoint || 0\n\n  this._view = {\n    shan: new Majiang.View.Shan($('.chang .shan'), this._model.shan),\n    shoupai: [],\n    he: [],\n    chang: new Majiang.View.Chang($('.chang'), this._chang, viewpoint),\n  }\n\n  this._view.chang.redraw()\n  this._view.shan.redraw()\n\n  var view_class = ['main', 'xiajia', 'duimian', 'shangjia']\n  for (var l = 0; l < 4; l++) {\n    var c = view_class[(this.player_id(l) + 4 - viewpoint) % 4]\n    this._view.shoupai[l] = new Majiang.View.Shoupai(\n      $('.shoupai.' + c),\n      this._model.shoupai[l],\n      this.player_id(l) == viewpoint\n    )\n    this._view.shoupai[l].redraw()\n\n    this._view.he[l] = new Majiang.View.He($('.he.' + c), this._model.he[l])\n    this._view.he[l].redraw()\n  }\n\n  Majiang.View.Say.init(viewpoint)\n\n  this._view.jiesuan = new Majiang.View.Jiesuan(\n    $('.jiesuan'),\n    this._model.shan,\n    this._chang,\n    viewpoint\n  )\n\n  new Majiang.View.Controler($('.controler'), this)\n}\n\nGame.prototype.qipai = function() {\n  var self = this\n\n  this._model = {\n    shan: new _model__WEBPACK_IMPORTED_MODULE_0__[\"Shan\"](this._chang.hongpai),\n    shoupai: [],\n    he: [],\n  }\n\n  this._lunban = -1\n  this._dapai = null\n  this._gangpai = null\n  this._fulou = null\n  this._kaigang = false\n\n  this._diyizimo = true\n  this._dafengpai = true\n\n  this._lizhi = [0, 0, 0, 0]\n  this._yifa = [false, false, false, false]\n  this._gang = [0, 0, 0, 0]\n\n  this._hule = []\n  this._hule_option = null\n  this._tmp_changbang = this._chang.changbang\n  this._lianzhuang = false\n  this._no_game = true\n\n  var qipai = [[], [], [], []]\n  for (var l = 0; l < 4; l++) {\n    for (var i = 0; i < 13; i++) {\n      qipai[l].push(this._model.shan.zimo())\n    }\n    this._model.shoupai[l] = new _model__WEBPACK_IMPORTED_MODULE_0__[\"Shoupai\"](qipai[l])\n    this._model.he[l] = new _model__WEBPACK_IMPORTED_MODULE_0__[\"He\"]()\n  }\n\n  this.create_view()\n\n  this._paipu.log.push([])\n\n  var defen = [0, 0, 0, 0]\n  for (var l = 0; l < 4; l++) {\n    defen[l] = this._chang.defen[this.player_id(l)]\n  }\n\n  var paipu = {\n    qipai: {\n      zhuangfeng: this._chang.zhuangfeng,\n      jushu: this._chang.jushu,\n      changbang: this._chang.changbang,\n      lizhibang: this._chang.lizhibang,\n      defen: defen,\n      baopai: this._model.shan.baopai()[0],\n      shoupai: this._model.shoupai.map(function(s) {\n        return s.toString()\n      }),\n    },\n  }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.qipai))\n    for (var i = 0; i < 4; i++) {\n      if (i != l) data[l].shoupai[i] = ''\n    }\n  }\n  this.notify_players('qipai', data)\n\n  this.delay(function() {\n    self.zimo()\n  })\n}\n\nGame.prototype.zimo = function() {\n  var self = this\n\n  if (this._lunban >= 0) {\n    this._view.shoupai[this._lunban].redraw()\n    this._view.he[this._lunban].redraw()\n  }\n\n  if (this._model.shan.paishu() == 0) {\n    this.delay(function() {\n      self.pingju('荒牌平局')\n    }, 0)\n    return\n  }\n\n  this._lunban = (this._lunban + 1) % 4\n\n  var zimo = this._model.shan.zimo()\n  this._model.shoupai[this._lunban].zimo(zimo)\n\n  this._view.chang.update(this._lunban)\n  this._view.shan.redraw()\n  this._view.shoupai[this._lunban].redraw()\n\n  var paipu = { zimo: { l: this._lunban, p: zimo } }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.zimo))\n    if (l != this._lunban) data[l].p = ''\n  }\n  this.call_players('zimo', data)\n}\n\nGame.prototype.dapai = function(dapai) {\n  var self = this\n\n  this._yifa[this._lunban] = false\n  this._fulou = null\n\n  this._model.shoupai[this._lunban].dapai(dapai)\n  this._model.he[this._lunban].dapai(dapai)\n\n  this._view.shoupai[this._lunban].dapai(dapai)\n  this.audio_play('dapai')\n  this._view.he[this._lunban].dapai(dapai)\n\n  if (this._diyizimo) {\n    if (!dapai.match(/^z[1234]/)) this._dafengpai = false\n    if (this._lunban > 0 && dapai.substr(0, 2) != this._dapai.substr(0, 2))\n      this._dafengpai = false\n  } else this._dafengpai = false\n\n  if (dapai.match(/\\*$/)) {\n    this._lizhi[this._lunban] = this._diyizimo ? 2 : 1\n    this._yifa[this._lunban] = true\n  }\n\n  this._dapai = dapai\n\n  var paipu = { dapai: { l: this._lunban, p: dapai } }\n  this.add_paipu(paipu)\n\n  if (this._kaigang) this.kaigang()\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.dapai))\n  }\n  this.call_players('dapai', data)\n}\n\nGame.prototype.fulou = function(fulou) {\n  var self = this\n\n  this._diyizimo = false\n  this._yifa = [false, false, false, false]\n  this._dapai = null\n\n  var d = fulou.match(/[\\-\\+\\=]/)[0]\n\n  this._view.shoupai[this._lunban].redraw()\n  this._model.he[this._lunban].fulou(d)\n  this._view.he[this._lunban].redraw()\n\n  this._lunban =\n    d == '-'\n      ? (this._lunban + 1) % 4\n      : d == '='\n      ? (this._lunban + 2) % 4\n      : d == '+'\n      ? (this._lunban + 3) % 4\n      : this._lunban\n  this._view.chang.update(this._lunban)\n\n  this._model.shoupai[this._lunban].fulou(fulou)\n  this._view.shoupai[this._lunban].redraw()\n\n  this._fulou = fulou\n\n  var paipu = { fulou: { l: this._lunban, m: fulou } }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.fulou))\n  }\n  this.call_players('fulou', data)\n}\n\nGame.prototype.gang = function(gang) {\n  var self = this\n\n  this._model.shoupai[this._lunban].gang(gang)\n  this._view.shoupai[this._lunban].redraw()\n\n  this._gang[this._lunban]++\n  this._gangpai = gang\n\n  var paipu = { gang: { l: this._lunban, m: gang } }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.gang))\n  }\n  this.call_players('gang', data)\n}\n\nGame.prototype.gangzimo = function() {\n  var self = this\n\n  this._diyizimo = false\n  this._yifa = [false, false, false, false]\n  this._dapai = null\n\n  if (this._kaigang) this.kaigang()\n\n  var zimo = this._model.shan.gangzimo()\n  this._model.shoupai[this._lunban].zimo(zimo)\n\n  this._view.shan.redraw()\n  this._view.shoupai[this._lunban].redraw()\n\n  var paipu = { gangzimo: { l: this._lunban, p: zimo } }\n  this.add_paipu(paipu)\n\n  if (this._gangpai && this._gangpai.match(/^[mpsz]\\d{4}$/)) this.kaigang()\n  else this._kaigang = true\n\n  this._gangpai = null\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.gangzimo))\n    if (l != this._lunban) data[l].p = ''\n  }\n  this.call_players('gangzimo', data)\n}\n\nGame.prototype.kaigang = function() {\n  this._model.shan.kaigang()\n  this._view.shan.redraw()\n\n  var baopai = this._model.shan.baopai().pop()\n  this._kaigang = false\n\n  var paipu = { kaigang: { baopai: baopai } }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.kaigang))\n  }\n  this.notify_players('kaigang', data)\n}\n\nGame.prototype.hule = function() {\n  var self = this\n\n  this._no_game = false\n\n  if (this._status != 'hule') {\n    this._hule_option =\n      this._status == 'gang'\n        ? 'qianggang'\n        : this._status == 'gangzimo'\n        ? 'lingshang'\n        : null\n  }\n\n  var lunban = this._hule.length > 0 ? this._hule.shift() : null\n  var rongpai\n  if (lunban != null) {\n    rongpai =\n      this._hule_option == 'qianggang'\n        ? this._gangpai[0] + this._gangpai.substr(-1)\n        : this._dapai.substr(0, 2)\n    rongpai = rongpai + ['', '+', '=', '-'][(4 + this._lunban - lunban) % 4]\n  }\n  lunban = lunban != null ? lunban : this._lunban\n\n  var new_shoupai = this._model.shoupai[lunban].clone()\n  if (rongpai) new_shoupai.zimo(rongpai.substr(0, 2))\n\n  this._view.shoupai[lunban].open()\n\n  var fubaopai = this._lizhi[lunban] ? this._model.shan.fubaopai() : null\n\n  var param = {\n    zhuangfeng: this._chang.zhuangfeng,\n    menfeng: lunban,\n    hupai: {\n      lizhi: this._lizhi[lunban],\n      yifa: this._yifa[lunban],\n      qianggang: this._hule_option == 'qianggang',\n      lingshang: this._hule_option == 'lingshang',\n      haidi:\n        this._model.shan.paishu() > 0 || this._hule_option == 'lingshang'\n          ? 0\n          : !rongpai\n          ? 1\n          : 2,\n      tianhu: this._diyizimo && !rongpai ? (lunban == 0 ? 1 : 2) : 0,\n    },\n    baopai: this._model.shan.baopai(),\n    fubaopai: fubaopai || [],\n    jicun: {\n      changbang: this._chang.changbang,\n      lizhibang: this._chang.lizhibang,\n    },\n  }\n  var hule = Object(_util_hule__WEBPACK_IMPORTED_MODULE_3__[\"utilHule\"])(new_shoupai, rongpai, param)\n\n  var info = {\n    lunban: lunban,\n    shoupai: new_shoupai,\n    hule: hule,\n    fubaopai: fubaopai,\n    fenpei: hule.fenpei,\n  }\n  this._view.jiesuan.hule(info)\n\n  if (lunban == 0) this._lianzhuang = true\n  this._chang.lizhibang = 0\n  this._chang.changbang = 0\n\n  for (var l = 0; l < 4; l++) {\n    this._chang.defen[this.player_id(l)] += hule.fenpei[l]\n  }\n\n  if (this._hule.length == 0) {\n    if (this._lianzhuang) this._chang.changbang = this._tmp_changbang + 1\n    else this._chang.changbang = 0\n  }\n\n  var paipu = {\n    hule: {\n      l: lunban,\n      shoupai: new_shoupai.toString(),\n      baojia: rongpai ? this._lunban : null,\n      fubaopai: fubaopai,\n      defen: hule.defen,\n      hupai: hule.hupai,\n      fenpei: hule.fenpei,\n    },\n  }\n  if (hule.damanguan) {\n    paipu.hule.damanguan = hule.damanguan\n  } else {\n    paipu.hule.fu = hule.fu\n    paipu.hule.fanshu = hule.fanshu\n  }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.hule))\n  }\n  this.call_players('hule', data, 5000)\n}\n\nGame.prototype.pingju = function(name) {\n  var self = this\n\n  var shoupai = ['', '', '', '']\n  var fenpei = [0, 0, 0, 0]\n\n  if (name == '荒牌平局') {\n    this._no_game = false\n\n    var n_tingpai = 0\n    for (var l = 0; l < 4; l++) {\n      if (\n        Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_4__[\"utilXiangting\"])(this._model.shoupai[l]) == 0 &&\n        Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_4__[\"utilTingpai\"])(this._model.shoupai[l]).length > 0\n      ) {\n        n_tingpai++\n        this._view.shoupai[l].open()\n        shoupai[l] = this._model.shoupai[l].toString()\n        if (l == 0) this._lianzhuang = true\n      }\n    }\n\n    for (var l = 0; l < 4; l++) {\n      var all_yaojiu = true\n      for (var p of this._model.he[l]._pai) {\n        if (p.match(/[\\-\\+\\=]$/)) {\n          all_yaojiu = false\n          break\n        }\n        if (p.match(/^z/)) continue\n        if (p.match(/^[mps][19]/)) continue\n        all_yaojiu = false\n        break\n      }\n      if (all_yaojiu) {\n        name = '流し満貫'\n        for (var lb = 0; lb < 4; lb++) {\n          fenpei[lb] +=\n            l == 0 && lb == l\n              ? 12000\n              : l == 0\n              ? -4000\n              : l != 0 && lb == l\n              ? 8000\n              : l != 0 && lb == 0\n              ? -4000\n              : -2000\n        }\n      }\n    }\n\n    if (name == '荒牌平局' && 0 < n_tingpai && n_tingpai < 4) {\n      for (var l = 0; l < 4; l++) {\n        fenpei[l] = shoupai[l] ? 3000 / n_tingpai : -3000 / (4 - n_tingpai)\n      }\n    }\n  } else if (name == '九種九牌') {\n    this._view.shoupai[this._lunban].open()\n    shoupai[this._lunban] = this._model.shoupai[this._lunban].toString()\n    this._lianzhuang = true\n  } else if (name == '四家立直') {\n    for (var l = 0; l < 4; l++) {\n      this._view.shoupai[l].open()\n      shoupai[l] = this._model.shoupai[l].toString()\n    }\n    this._lianzhuang = true\n  } else if (name == '三家和') {\n    for (var l of this._hule) {\n      this._view.shoupai[l].open()\n      shoupai[l] = this._model.shoupai[l].toString()\n    }\n    this._lianzhuang = true\n  } else this._lianzhuang = true\n\n  this._view.jiesuan.pingju({ name: name, fenpei: fenpei })\n\n  this._chang.changbang++\n\n  for (var l = 0; l < 4; l++) {\n    this._chang.defen[this.player_id(l)] += fenpei[l]\n  }\n\n  var paipu = { pingju: { name: name, shoupai: shoupai, fenpei: fenpei } }\n  this.add_paipu(paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = JSON.parse(JSON.stringify(paipu.pingju))\n  }\n  this.call_players('pingju', data, 5000)\n}\n\nGame.prototype.jiesuan = function() {\n  var self = this\n\n  this._view.chang.redraw()\n\n  if (!this._lianzhuang) {\n    this._chang.jushu++\n    if (this._chang.jushu == 4) {\n      this._chang.zhuangfeng++\n      this._chang.jushu = 0\n    }\n  }\n\n  var jieju = false\n  var guanjun = -1\n  var defen = this._chang.defen\n  for (var i = 0; i < 4; i++) {\n    var id = (this._chang.qijia + i) % 4\n    if (defen[id] < 0) jieju = true\n    if (defen[id] >= 30000 && (guanjun == -1 || defen[id] > defen[guanjun]))\n      guanjun = id\n  }\n\n  if (this._chang.zhuangfeng == 3) jieju = true\n  else if (this._chang.zhuangfeng == 2) {\n    if (guanjun != -1) jieju = true\n  } else if (this._chang.zhuangfeng == 1 && this._chang.jushu == 3) {\n    if (guanjun == this.player_id(0) && this._lianzhuang && !this._no_game)\n      jieju = true\n  }\n\n  if (jieju)\n    this.delay(function() {\n      self.jieju()\n    })\n  else\n    this.delay(function() {\n      self.qipai()\n    })\n}\n\nGame.prototype.jieju = function() {\n  var paiming = []\n  var defen = this._chang.defen\n  for (var i = 0; i < 4; i++) {\n    var id = (this._chang.qijia + i) % 4\n    for (var j = 0; j < 4; j++) {\n      if (j == paiming.length || defen[id] > defen[paiming[j]]) {\n        paiming.splice(j, 0, id)\n        break\n      }\n    }\n  }\n  defen[paiming[0]] += this._chang.lizhibang * 1000\n\n  var rank = [0, 0, 0, 0]\n  for (var i = 0; i < 4; i++) {\n    rank[paiming[i]] = i + 1\n  }\n\n  var point = [0, 0, 0, 0]\n  for (var i = 1; i < 4; i++) {\n    var id = paiming[i]\n    point[id] =\n      Math.round((defen[id] - 30000) / 1000) +\n      (i == 1 ? 10 : i == 2 ? -10 : i == 3 ? -20 : 0)\n    point[paiming[0]] -= point[id]\n  }\n\n  this._paipu.defen = defen.concat()\n  this._paipu.rank = rank.concat()\n  this._paipu.point = point.concat()\n\n  Majiang.View.Jiezhang($('.jiezhang'), this._paipu)\n\n  var data = []\n  for (var l = 0; l < 4; l++) {\n    data[l] = {\n      jieju: {\n        defen: defen.concat(),\n        rank: rank.concat(),\n        point: point.concat(),\n      },\n    }\n  }\n  this.call_players('jieju', data, 10000)\n}\n\n\n//# sourceURL=webpack:///./js/game.js?");

/***/ }),

/***/ "./js/index.js":
/*!*********************!*\
  !*** ./js/index.js ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _majiang__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./majiang */ \"./js/majiang.js\");\n/* harmony import */ var _game__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./game */ \"./js/game.js\");\n\n\n\nvar game, paipu, editor\nwindow.Majiang = {}\n$(function() {\n  $('.version').text('ver. ' + _majiang__WEBPACK_IMPORTED_MODULE_0__[\"VERSION\"])\n  $('#title .loading').text('Loading...')\n\n  var id = setInterval(function() {\n    $('#title .loading').text($('#title .loading').text() + '.')\n  }, 1000)\n\n  function start() {\n    $('body')\n      .removeClass('editor')\n      .addClass('game')\n    $('#editor').hide()\n    $('#game').show()\n    game = new _game__WEBPACK_IMPORTED_MODULE_1__[\"Game\"]()\n    game._callback = end\n    game.kaiju()\n  }\n\n  function end() {\n    $('#game').hide()\n    $('body')\n      .removeClass('game')\n      .addClass('editor')\n    $('#editor').show()\n    while (editor._model.length() >= 10) {\n      editor._model.del_paipu(0)\n    }\n    editor.start(game._paipu)\n  }\n\n  editor = new Majiang.PaipuEditor('Majiang.game')\n  $('#editor .next').on('click', start)\n\n  $(window).load(function() {\n    Majiang.Audio.volume(1)\n    clearInterval(id)\n    setTimeout(function() {\n      $('#title').hide()\n      if (editor._model.length() > 0) {\n        $('body')\n          .removeClass('game')\n          .addClass('editor')\n        editor.start()\n      } else {\n        start()\n      }\n    }, 2000)\n  })\n})\n\n\n//# sourceURL=webpack:///./js/index.js?");

/***/ }),

/***/ "./js/majiang.js":
/*!***********************!*\
  !*** ./js/majiang.js ***!
  \***********************/
/*! exports provided: VERSION */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"VERSION\", function() { return VERSION; });\n/*\n *  Majiang\n *\n *  Copyright(C) 2017 Satoshi Kobayashi\n *  Released under the MIT license\n *  https://github.com/kobalab/Majiang/blob/master/LICENSE\n */\n\nlet VERSION = '0.9.9'\n\n\n//# sourceURL=webpack:///./js/majiang.js?");

/***/ }),

/***/ "./js/model.js":
/*!*********************!*\
  !*** ./js/model.js ***!
  \*********************/
/*! exports provided: Shoupai, Shan, He */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Shoupai\", function() { return Shoupai; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Shan\", function() { return Shan; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"He\", function() { return He; });\n/*\n *  Shoupai\n */\n\nconst Shoupai = function(qipai) {\n  this._bingpai = {\n    m: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    p: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    s: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    z: [0, 0, 0, 0, 0, 0, 0, 0],\n  }\n  this._fulou = []\n  this._zimo = null\n\n  if (!qipai) return\n  for (var p of qipai) {\n    this._bingpai[p[0]][p[1]]++\n    if (p[1] == '0') this._bingpai[p[0]][5]++\n  }\n}\n\nShoupai.fromString = function(paistr) {\n  var qipai = []\n  var fulou = paistr.split(',')\n  var bingpai = fulou.shift()\n  for (var substr of bingpai.match(/[mpsz]\\d+/g) || []) {\n    var s = substr[0]\n    for (var n of substr.match(/\\d/g)) {\n      if (s == 'z' && (n < 1 || 7 < n)) continue\n      qipai.push(s + n)\n    }\n  }\n  while (qipai.length > 14 - fulou.length * 3) qipai.pop()\n  var zimo = (qipai.length - 2) % 3 == 0 && qipai.pop()\n  var shoupai = new Shoupai(qipai)\n  if (zimo) shoupai.zimo(zimo)\n  for (var m of fulou) {\n    var h = m.replace(/0/g, '5')\n    if (\n      h.match(/^[mpsz](\\d)\\1\\1[\\-\\+\\=]?\\1?$/) ||\n      h.match(/^[mpsz](\\d)\\1\\1\\1[\\-\\+\\=]?$/)\n    ) {\n      m = m.replace(/([mps])05/, '$1' + '50')\n      shoupai._fulou.push(m)\n    } else if (h.match(/^[mpsz]\\d+\\-\\d*$/)) {\n      var hongpai = m.match(/0/)\n      var s = h[0]\n      var nn = h.match(/\\d[\\-\\+\\=]?/g).sort()\n      if (nn.length != 3) continue\n      var n = nn[0][0] - 0\n      if (n + 1 != nn[1][0] || n + 2 != nn[2][0]) continue\n      m = s + nn.join('')\n      if (hongpai) m = m.replace(/5/, '0')\n      shoupai._fulou.push(m)\n    }\n  }\n\n  return shoupai\n}\n\nShoupai.fromTenhouString = function(tenhoustr) {\n  var fulou = tenhoustr.split(',')\n  var bingpai = fulou.shift()\n  var paistr = bingpai.replace(/(\\d+)([mpsz])/g, '$2$1')\n  if (fulou.length) {\n    paistr +=\n      ',' +\n      fulou\n        .reverse()\n        .join(',')\n        .match(/./g)\n        .reverse()\n        .join('')\n  }\n  return Shoupai.fromString(paistr)\n}\n\nShoupai.prototype.clone = function() {\n  var shoupai = new Shoupai([])\n\n  shoupai._bingpai = {\n    m: this._bingpai.m.concat(),\n    p: this._bingpai.p.concat(),\n    s: this._bingpai.s.concat(),\n    z: this._bingpai.z.concat(),\n  }\n  shoupai._fulou = this._fulou.concat()\n  shoupai._zimo = this._zimo\n\n  return shoupai\n}\n\nShoupai.prototype.toString = function() {\n  var paistr = ''\n  for (var s of ['m', 'p', 's', 'z']) {\n    var substr = s\n    var bingpai = this._bingpai[s]\n    var hongpai = bingpai[0]\n    for (var n = 1; n < bingpai.length; n++) {\n      var num = bingpai[n]\n      if (this._zimo && s + n == this._zimo) num--\n      if (this._zimo && n == 5 && s + '0' == this._zimo) {\n        hongpai--\n        num--\n      }\n      for (var i = 0; i < num; i++) {\n        if (n == 5 && hongpai > 0) {\n          substr += '0'\n          hongpai--\n        } else substr += n\n      }\n    }\n    if (substr.length > 1) paistr += substr\n  }\n  if (this._zimo && this._zimo.length == 2) {\n    paistr += this._zimo\n  }\n  for (var m of this._fulou) {\n    paistr += ',' + m\n  }\n  return paistr\n}\n\nShoupai.prototype.toTenhouString = function() {\n  var paistr = this.toString()\n  var fulou = paistr.split(',')\n  var bingpai = fulou.shift()\n  var tenhoustr = bingpai.replace(/([mpsz])(\\d+)/g, '$2$1')\n  for (var m of fulou) {\n    m = m\n      .match(/./g)\n      .reverse()\n      .join('')\n    if (!m.replace(/0/g, '5').match(/(\\d)\\1\\1[mpsz]$/)) {\n      m = m.replace(/(\\d*)(\\-\\d)(\\d*)/, '$2$1$3')\n    }\n    tenhoustr += ',' + m\n  }\n  return tenhoustr\n}\n\nShoupai.prototype.zimo = function(p) {\n  if (!this._zimo) {\n    this._zimo = p\n    this._bingpai[p[0]][p[1]]++\n    if (p[0] != 'z' && p[1] == '0') this._bingpai[p[0]][5]++\n  }\n}\n\nShoupai.prototype.dapai = function(p) {\n  if (this._zimo) {\n    this._zimo = null\n    this._bingpai[p[0]][p[1]]--\n    if (p[1] == '0') this._bingpai[p[0]][5]--\n  }\n}\n\nShoupai.prototype.fulou = function(m) {\n  if (!this._zimo) {\n    this._fulou.push(m)\n    for (var n of m.match(/\\d(?![\\-\\+\\=])/g)) {\n      this._bingpai[m[0]][n]--\n      if (n == '0') this._bingpai[m[0]][5]--\n    }\n    if (!m.match(/\\d{4}/)) this._zimo = m\n  }\n}\n\nShoupai.prototype.gang = function(p) {\n  if (this._zimo && this._zimo.length == 2) {\n    p = p.replace(/0/g, '5')\n    if (this._bingpai[p[0]][p[1]] > 3) {\n      var m = p[0] + p[1] + p[1] + p[1] + p[1]\n      if (p[1] == '5') {\n        while (this._bingpai[p[0]][0]) {\n          m = m.replace(/5(?!5)/, '0')\n          this._bingpai[p[0]][0]--\n        }\n      }\n      this._fulou.push(m)\n      this._bingpai[p[0]][p[1]] -= 4\n    } else {\n      var regexp =\n        p[1] == '5'\n          ? new RegExp('^' + p[0] + '[05]{3}')\n          : new RegExp('^' + p[0] + p[1] + '{3}')\n      for (var i = 0; i < this._fulou.length; i++) {\n        if (this._fulou[i].match(regexp)) {\n          if (p[1] == '5' && this._bingpai[p[0]][0]) {\n            this._fulou[i] += '0'\n            this._bingpai[p[0]][0]--\n          } else {\n            this._fulou[i] += p[1]\n          }\n          this._bingpai[p[0]][p[1]]--\n        }\n      }\n    }\n    this._zimo = null\n  }\n}\n\n/*\n *  Shan\n */\n\nconst Shan = function(hongpai) {\n  if (!hongpai) hongpai = { m: 0, p: 0, s: 0 }\n\n  var pai = []\n  for (var s of ['m', 'p', 's', 'z']) {\n    for (var n = 1; n <= (s == 'z' ? 7 : 9); n++) {\n      for (var i = 0; i < 4; i++) {\n        if (hongpai[s] && n == 5 && i < hongpai[s]) pai.push(s + '0')\n        else pai.push(s + n)\n      }\n    }\n  }\n  this._pai = []\n  while (pai.length > 0) {\n    var r = Math.floor(Math.random() * pai.length)\n    var p = pai[r]\n    pai.splice(r, 1)\n    this._pai.push(p)\n  }\n\n  this._baopai = [this._pai[4]]\n  this._fubaopai = [this._pai[9]]\n\n  this._weikaigang = false\n}\n\nShan.zhenbaopai = function(p) {\n  if (p[0] == 'z')\n    return p[1] < 5 ? p[0] + ((p[1] % 4) + 1) : p[0] + (((p[1] - 4) % 3) + 5)\n  else return p[1] == '0' ? p[0] + '6' : p[0] + ((p[1] % 9) + 1)\n}\n\nShan.prototype.paishu = function() {\n  return this._pai.length - 14\n}\n\nShan.prototype.zimo = function() {\n  if (this.paishu() > 0) return this._pai.pop()\n}\n\nShan.prototype.baopai = function() {\n  return this._baopai.concat()\n}\n\nShan.prototype.fubaopai = function() {\n  return this._fubaopai.concat()\n}\n\nShan.prototype.gangzimo = function() {\n  if (this.paishu() > 0 && this._baopai.length < 5 && !this._weikaigang) {\n    this._weikaigang = true\n    return this._pai.shift()\n  }\n}\n\nShan.prototype.kaigang = function() {\n  if (this._weikaigang) {\n    this._baopai.push(this._pai[4])\n    this._fubaopai.push(this._pai[9])\n    this._weikaigang = false\n  }\n}\n\n/*\n *  He\n */\n\nconst He = function() {\n  this._pai = []\n}\nHe.prototype.dapai = function(p) {\n  this._pai.push(p)\n}\nHe.prototype.fulou = function(d) {\n  this._pai[this._pai.length - 1] += d\n}\n\n/*\n *  Shan.Fake\n */\n\nShan.Fake = function(baopai) {\n  this._paishu = 136 - 13 * 4 - 14\n  this._baopai = [baopai]\n  this._fubaopai = []\n}\n\nShan.Fake.prototype.paishu = function() {\n  return this._paishu\n}\n\nShan.Fake.prototype.zimo = function(p) {\n  this._paishu--\n  return p\n}\n\nShan.Fake.prototype.baopai = function() {\n  return this._baopai.concat()\n}\n\nShan.Fake.prototype.fubaopai = function(pai) {\n  if (pai) this._fubaopai = pai\n  else return this._fubaopai.concat()\n}\n\nShan.Fake.prototype.gangzimo = function() {\n  this._paishu--\n  return ''\n}\n\nShan.Fake.prototype.kaigang = function(p) {\n  this._baopai.push(p)\n  return p\n}\n\n\n//# sourceURL=webpack:///./js/model.js?");

/***/ }),

/***/ "./js/player.js":
/*!**********************!*\
  !*** ./js/player.js ***!
  \**********************/
/*! exports provided: Player */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Player\", function() { return Player; });\n/* harmony import */ var _model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./model */ \"./js/model.js\");\n/* harmony import */ var _suanpai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./suanpai */ \"./js/suanpai.js\");\n/* harmony import */ var _util_xiangting__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util/xiangting */ \"./js/util/xiangting.js\");\n/* harmony import */ var _util_hule__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./util/hule */ \"./js/util/hule.js\");\n/*\n *  Player\n */\n\n\n\n\n\nconst Player = function(id) {\n  this._id = id\n}\n\nPlayer.prototype.action = function(type, data, callback) {\n  if (type == 'kaiju') this.kaiju(data)\n  else if (type == 'qipai') this.qipai(data)\n  else if (type == 'zimo') this.zimo(data, callback)\n  else if (type == 'dapai') this.dapai(data, callback)\n  else if (type == 'fulou') this.fulou(data, callback)\n  else if (type == 'gang') this.gang(data, callback)\n  else if (type == 'kaigang') this.kaigang(data)\n  else if (type == 'gangzimo') this.zimo(data, callback, 'lingshang')\n  else if (type == 'hule') this.hule(data, callback)\n  else if (type == 'pingju') this.pingju(data, callback)\n  else if (type == 'jieju') this.jieju(data, callback)\n}\n\nPlayer.prototype.wait = function(callback) {\n  callback()\n}\n\nPlayer.prototype.kaiju = function(data) {\n  this._chang = {\n    player: data.player,\n    qijia: data.qijia,\n    hongpai: data.hongpai,\n  }\n}\n\nPlayer.prototype.qipai = function(data) {\n  this._zhuangfeng = data.zhuangfeng\n  this._menfeng = (8 + this._id - this._chang.qijia - data.jushu) % 4\n  this._changbang = data.changbang\n  this._lizhibang = data.lizhibang\n  this._defen = data.defen\n\n  this._shoupai = _model__WEBPACK_IMPORTED_MODULE_0__[\"Shoupai\"].fromString(data.shoupai[this._menfeng])\n  this._menqian = true\n  this._dapai = {}\n  this._neng_rong = true\n\n  this._paishu = 136 - 13 * 4 - 14\n  this._baopai = [data.baopai]\n  this._diyizimo = true\n  this._lizhi = [0, 0, 0, 0]\n  this._yifa = [false, false, false, false]\n\n  this._suanpai = new _suanpai__WEBPACK_IMPORTED_MODULE_1__[\"Suanpai\"](this._chang.hongpai)\n  this._suanpai.qipai(data, this._menfeng)\n\n  this._defen_cache = {}\n}\n\nPlayer.prototype.zimo = function(data, callback, option) {\n  this._suanpai.zimo(data)\n\n  this._paishu--\n\n  if (data.l != this._menfeng) {\n    callback()\n    return\n  }\n\n  this._shoupai.zimo(data.p)\n\n  this._eval_cache = {}\n  this.action_zimo(data, callback, option)\n\n  this._diyizimo = false\n}\n\nPlayer.prototype.action_zimo = function(data, callback, option) {\n  var mianzi\n  if (this.select_hule(null, option)) callback('hule')\n  else if (this.select_pingju()) callback('pingju')\n  else if ((mianzi = this.select_gang())) callback('gang', mianzi)\n  else callback('dapai', this.select_dapai())\n}\n\nPlayer.prototype.dapai = function(data, callback) {\n  this._suanpai.dapai(data)\n\n  this._yifa[data.l] == false\n\n  if (data.l == this._menfeng) {\n    this._shoupai.dapai(data.p)\n\n    if (!this._lizhi[this._menfeng]) this._neng_rong = true\n    this._dapai[data.p.substr(0, 2).replace(/0/, '5')] = true\n    if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai) == 0) {\n      for (var p of Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(this._shoupai)) {\n        if (this._dapai[p]) this._neng_rong = false\n      }\n    }\n\n    callback()\n  } else {\n    this._eval_cache = {}\n    this.action_dapai(data, callback)\n  }\n\n  if (data.p.match(/\\*$/)) {\n    this._lizhi[data.l] = this._diyizimo ? 2 : 1\n    this._yifa[data.l] = true\n    this._lizhibang++\n  }\n\n  var new_shoupai = this._shoupai.clone()\n  new_shoupai.zimo(data.p.substr(0, 2))\n  if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) == -1) {\n    this._neng_rong = false\n  }\n}\n\nPlayer.prototype.action_dapai = function(data, callback) {\n  var mianzi\n  if (this.select_hule(data)) callback('hule')\n  else if ((mianzi = this.select_fulou(data))) callback('fulou', mianzi)\n  else callback()\n}\n\nPlayer.prototype.fulou = function(data, callback) {\n  this._suanpai.fulou(data)\n\n  this._diyizimo = false\n  this._yifa = [false, false, false, false]\n\n  if (data.l != this._menfeng) {\n    callback()\n    return\n  }\n\n  this._shoupai.fulou(data.m)\n  this._menqian = false\n\n  if (data.m.match(/^[mpsz]\\d{4}/)) {\n    callback()\n    return\n  }\n\n  this.action_fulou(data, callback)\n}\n\nPlayer.prototype.action_fulou = function(data, callback) {\n  callback('dapai', this.select_dapai())\n}\n\nPlayer.prototype.gang = function(data, callback) {\n  this._suanpai.gang(data)\n\n  this._diyizimo = false\n  this._yifa = [false, false, false, false]\n\n  if (data.l == this._menfeng) {\n    this._shoupai.gang(data.m)\n    callback()\n    return\n  }\n\n  if (!data.m.match(/^[mpsz]\\d{4}/)) {\n    this.action_gang(data, callback)\n\n    var new_shoupai = this._shoupai.clone()\n    new_shoupai.zimo(data.m.substr(0, 2))\n    if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) == -1) {\n      this._neng_rong = false\n    }\n  } else callback()\n}\n\nPlayer.prototype.action_gang = function(data, callback) {\n  if (this.select_hule(data, 'qianggang')) callback('hule')\n  else callback()\n}\n\nPlayer.prototype.kaigang = function(data) {\n  this._suanpai.kaigang(data)\n\n  this._baopai.push(data.baopai)\n\n  this._defen_cache = {}\n}\n\nPlayer.prototype.hule = function(data, callback) {\n  this.wait(callback)\n}\n\nPlayer.prototype.pingju = function(data, callback) {\n  this.wait(callback)\n}\n\nPlayer.prototype.jieju = function(data, callback) {\n  this.wait(callback)\n}\n\nfunction get_dapai(shoupai) {\n  var pai = []\n\n  var fulou = shoupai._zimo.replace(/0/, '5')\n  var deny = {}\n  var s = fulou[0]\n  var n = +fulou.match(/\\d(?=[\\-\\+\\=])/)\n  if (n) {\n    deny[s + n] = true\n    if (!fulou.match(/^[mpsz](\\d)\\1\\1.*$/)) {\n      if (n < 7 && fulou.match(/^[mps]\\d\\-\\d\\d$/)) deny[s + (n + 3)] = true\n      if (3 < n && fulou.match(/^[mps]\\d\\d\\d\\-$/)) deny[s + (n - 3)] = true\n    }\n  }\n\n  for (var s of ['m', 'p', 's', 'z']) {\n    var bingpai = shoupai._bingpai[s]\n    for (var n = 1; n < bingpai.length; n++) {\n      if (bingpai[n] == 0) continue\n      if (deny[s + n]) continue\n      if (n != 5) pai.push(s + n)\n      else {\n        if (bingpai[0] > 0) pai.push(s + '0')\n        if (bingpai[0] < bingpai[5]) pai.push(s + '5')\n      }\n    }\n  }\n\n  return pai\n}\n\nPlayer.prototype.get_dapai = function() {\n  if (this._lizhi[this._menfeng]) return [this._shoupai._zimo]\n\n  return get_dapai(this._shoupai)\n}\n\nfunction get_chi_mianzi(shoupai, p) {\n  var mianzi = []\n\n  var s = p[0],\n    n = p[1] - 0 || 5,\n    d = p[2]\n  if (s == 'z' || d != '-') return mianzi\n\n  var bingpai = shoupai._bingpai[s]\n  var p0 = p[1],\n    p1,\n    p2\n\n  if (3 <= n && bingpai[n - 2] > 0 && bingpai[n - 1] > 0) {\n    p1 = n - 2 == 5 && bingpai[0] > 0 ? 0 : n - 2\n    p2 = n - 1 == 5 && bingpai[0] > 0 ? 0 : n - 1\n    if (\n      (3 < n ? bingpai[n - 3] : 0) + bingpai[n] <\n      14 - (shoupai._fulou.length + 1) * 3\n    )\n      mianzi.push(s + p1 + p2 + (p0 + d))\n  }\n  if (n <= 7 && bingpai[n + 1] > 0 && bingpai[n + 2] > 0) {\n    p1 = n + 1 == 5 && bingpai[0] > 0 ? 0 : n + 1\n    p2 = n + 2 == 5 && bingpai[0] > 0 ? 0 : n + 2\n    if (\n      bingpai[n] + (n < 7 ? bingpai[n + 3] : 0) <\n      14 - (shoupai._fulou.length + 1) * 3\n    )\n      mianzi.push(s + (p0 + d) + p1 + p2)\n  }\n  if (2 <= n && n <= 8 && bingpai[n - 1] > 0 && bingpai[n + 1] > 0) {\n    p1 = n - 1 == 5 && bingpai[0] > 0 ? 0 : n - 1\n    p2 = n + 1 == 5 && bingpai[0] > 0 ? 0 : n + 1\n    if (bingpai[n] < 14 - (shoupai._fulou.length + 1) * 3)\n      mianzi.push(s + p1 + (p0 + d) + p2)\n  }\n\n  return mianzi\n}\n\nPlayer.prototype.get_chi_mianzi = function(data) {\n  if (this._paishu == 0) return []\n  if (this._lizhi[this._menfeng]) return []\n\n  var d = ['', '+', '=', '-'][(4 + data.l - this._menfeng) % 4]\n\n  return get_chi_mianzi(this._shoupai, data.p.substr(0, 2) + d)\n}\n\nfunction get_peng_mianzi(shoupai, p) {\n  var mianzi = []\n\n  var s = p[0],\n    n = p[1] - 0 || '5',\n    d = p[2]\n  var bingpai = shoupai._bingpai[s]\n\n  if (bingpai[n] >= 2) {\n    var p0 = p[1]\n    var p1 = n == 5 && bingpai[0] > 1 ? 0 : n\n    var p2 = n == 5 && bingpai[0] > 0 ? 0 : n\n    mianzi = [s + p1 + p2 + (p0 + d)]\n  }\n\n  return mianzi\n}\n\nPlayer.prototype.get_peng_mianzi = function(data) {\n  if (this._paishu == 0) return []\n  if (this._lizhi[this._menfeng]) return []\n\n  var d = ['', '+', '=', '-'][(4 + data.l - this._menfeng) % 4]\n\n  return get_peng_mianzi(this._shoupai, data.p.substr(0, 2) + d)\n}\n\nfunction get_gang_mianzi(shoupai, p) {\n  var mianzi = []\n\n  if (p) {\n    var s = p[0],\n      n = +p[1] || 5,\n      d = p[2]\n    var bingpai = shoupai._bingpai[s]\n\n    if (bingpai[n] == 3) {\n      var p0 = p[1]\n      var p1 = n == 5 && bingpai[0] > 2 ? 0 : n\n      var p2 = n == 5 && bingpai[0] > 1 ? 0 : n\n      var p3 = n == 5 && bingpai[0] > 0 ? 0 : n\n      mianzi = [s + p1 + p2 + p3 + (p0 + d)]\n    }\n  } else {\n    for (var s of ['m', 'p', 's', 'z']) {\n      var bingpai = shoupai._bingpai[s]\n      for (var n = 1; n < bingpai.length; n++) {\n        if (bingpai[n] == 0) continue\n        if (bingpai[n] == 4) {\n          var p0 = n == 5 && bingpai[0] > 3 ? 0 : n\n          var p1 = n == 5 && bingpai[0] > 2 ? 0 : n\n          var p2 = n == 5 && bingpai[0] > 1 ? 0 : n\n          var p3 = n == 5 && bingpai[0] > 0 ? 0 : n\n          mianzi.push(s + p0 + p1 + p2 + p3)\n        } else {\n          for (var m of shoupai._fulou) {\n            if (m.replace(/0/g, '5').substr(0, 4) == s + n + n + n) {\n              var p0 = n == 5 && bingpai[0] > 0 ? 0 : n\n              mianzi.push(m + p0)\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return mianzi\n}\n\nPlayer.prototype.get_gang_mianzi = function(data) {\n  if (this._paishu == 0) return []\n  if (this._baopai.length == 5) return []\n\n  if (data) {\n    if (this._lizhi[this._menfeng]) return []\n    var d = ['', '+', '=', '-'][(4 + data.l - this._menfeng) % 4]\n    return get_gang_mianzi(this._shoupai, data.p.substr(0, 2) + d)\n  } else {\n    var mianzi = get_gang_mianzi(this._shoupai)\n\n    if (this._lizhi[this._menfeng] && mianzi.length) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.dapai(this._shoupai._zimo)\n      var tingpai = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(new_shoupai).join(',')\n\n      for (var m of mianzi) {\n        if (\n          this._shoupai._zimo.replace(/0/, '5') !=\n          m.replace(/0/, '5').substr(0, 2)\n        )\n          continue\n        new_shoupai = this._shoupai.clone()\n        new_shoupai.gang(m)\n        if (\n          Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) == 0 &&\n          Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(new_shoupai).join(',') == tingpai\n        ) {\n          return [m]\n        }\n      }\n      return []\n    }\n    return mianzi\n  }\n}\n\nPlayer.prototype.allow_lizhi = function(p) {\n  if (\n    !this._lizhi[this._menfeng] &&\n    this._menqian &&\n    Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai) == 0 &&\n    this._paishu >= 4 &&\n    this._defen[this._menfeng] >= 1000\n  ) {\n    if (p == null) return true\n    else {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.dapai(p)\n      return (\n        Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) == 0 &&\n        Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(new_shoupai).length > 0\n      )\n    }\n  }\n  return false\n}\n\nPlayer.prototype.allow_hule = function(data, option) {\n  var rongpai =\n    data && (data.p ? data.p.substr(0, 2) : data.m[0] + data.m.substr(-1))\n\n  if (rongpai && !this._neng_rong) return false\n\n  var new_shoupai = this._shoupai.clone()\n  if (rongpai) new_shoupai.zimo(rongpai)\n  if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) != -1) return false\n\n  if (rongpai) rongpai += ['', '+', '=', '-'][(4 + data.l - this._menfeng) % 4]\n\n  var l = this._menfeng\n  var param = {\n    zhuangfeng: this._zhuangfeng,\n    menfeng: l,\n    hupai: {\n      lizhi: this._lizhi[l],\n      yifa: this._yifa[l],\n      qianggang: option == 'qianggang',\n      lingshang: option == 'lingshang',\n      haidi: this._paishu > 0 ? 0 : !rongpai ? 1 : 2,\n      tianhu: this._diyizimo && !rongpai ? (l == 0 ? 1 : 2) : 0,\n    },\n    baopai: this._baopai,\n    fubaopai: [],\n    jicun: { changbang: this._changbang, lizhibang: this._lizhibang },\n  }\n  var hule = Object(_util_hule__WEBPACK_IMPORTED_MODULE_3__[\"utilHule\"])(new_shoupai, rongpai, param)\n\n  this._neng_rong = false\n\n  return hule.hupai\n}\n\nPlayer.prototype.allow_pingju = function() {\n  if (!this._diyizimo) return false\n\n  var n_yaojiu = 0\n  for (var s in this._shoupai._bingpai) {\n    var bingpai = this._shoupai._bingpai[s]\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [1, 9]\n    for (var n of nn) {\n      if (bingpai[n] > 0) n_yaojiu++\n    }\n  }\n  return n_yaojiu >= 9\n}\n\nPlayer.prototype.select_fulou = function(data) {\n  if (\n    this._lizhi.filter(function(x) {\n      return x\n    }).length > 0\n  )\n    return\n\n  var n_xiangting = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai)\n\n  if (n_xiangting < 3) {\n    var mianzi = this.get_gang_mianzi(data)\n      .concat(this.get_peng_mianzi(data))\n      .concat(this.get_chi_mianzi(data))\n    if (!mianzi.length) return\n\n    var fulou\n    var paishu = this._suanpai.suan_paishu_all()\n    var max = this.eval_shoupai(this._shoupai, paishu)\n\n    for (var m of mianzi) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.fulou(m)\n      if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) >= 3) continue\n\n      var ev = this.eval_shoupai(new_shoupai, paishu)\n\n      if (ev > max) {\n        max = ev\n        fulou = m\n      }\n    }\n    return fulou\n  } else {\n    n_xiangting = this.xiangting(this._shoupai)\n\n    for (var m of this.get_gang_mianzi(data)) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.fulou(m)\n      if (\n        this.xiangting(new_shoupai) == n_xiangting &&\n        new_shoupai._fulou.filter(function(mm) {\n          return mm.match(/^[mpsz](\\d)\\1\\1.*\\1.*$/)\n        }).length >= 3\n      ) {\n        return m\n      }\n    }\n\n    if (n_xiangting == 0) return\n    for (var m of this.get_peng_mianzi(data).concat(\n      this.get_chi_mianzi(data)\n    )) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.fulou(m)\n      if (this.xiangting(new_shoupai) < n_xiangting) return m\n    }\n  }\n}\n\nPlayer.prototype.select_gang = function() {\n  var n_xiangting = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai)\n\n  if (\n    this._lizhi.filter(function(x) {\n      return x\n    }).length > 0 &&\n    n_xiangting > 0\n  )\n    return\n\n  if (n_xiangting < 3) {\n    var paishu = this._suanpai.suan_paishu_all()\n    var ev = this.eval_shoupai(this._shoupai, paishu)\n\n    for (var m of this.get_gang_mianzi()) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.gang(m)\n      if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) >= 3) continue\n\n      if (this.eval_shoupai(new_shoupai, paishu) > ev) return m\n    }\n  } else {\n    n_xiangting = this.xiangting(this._shoupai)\n\n    for (var m of this.get_gang_mianzi()) {\n      var new_shoupai = this._shoupai.clone()\n      new_shoupai.gang(m)\n\n      n_xiangting = this.xiangting(this._shoupai)\n      if (this.xiangting(new_shoupai) <= n_xiangting) return m\n    }\n  }\n}\n\nPlayer.prototype.select_lizhi = function(p) {\n  return this.allow_lizhi(p)\n}\n\nPlayer.prototype.select_hule = function(data, option) {\n  return this.allow_hule(data, option)\n}\n\nPlayer.prototype.select_pingju = function() {\n  if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai) < 4) return false\n  return this.allow_pingju()\n}\n\nPlayer.prototype.select_dapai = function() {\n  function suan_weixian(p) {\n    var weixian = 0\n    for (var l = 0; l < 4; l++) {\n      if (!self._lizhi[l]) continue\n      var w = self._suanpai.suan_weixian(p, l)\n      if (w > weixian) weixian = w\n    }\n    return weixian\n  }\n\n  var n_suit, n_sifeng, n_sanyuan\n\n  function paijia(p) {\n    if (!n_suit) {\n      n_suit = { m: 0, p: 0, s: 0, z: 0 }\n      for (var s of ['m', 'p', 's', 'z']) {\n        var bingpai = self._shoupai._bingpai[s]\n        for (var n = 1; n < bingpai.length; n++) {\n          n_suit[s] += bingpai[n]\n        }\n      }\n      var bingpai = self._shoupai._bingpai.z\n      n_sifeng = bingpai[1] + bingpai[2] + bingpai[3] + bingpai[4]\n      n_sanyuan = bingpai[5] + bingpai[6] + bingpai[7]\n      for (var m of self._shoupai._fulou) {\n        n_suit[m[0]] += 3\n        if (m.match(/^z[1234]/)) n_sifeng += 3\n        if (m.match(/^z[567]/)) n_sanyuan += 3\n      }\n    }\n    return (\n      self._suanpai.paijia(p) *\n      (p.match(/^z[1234]/) && n_sifeng >= 9\n        ? 8\n        : p.match(/^z[567]/) && n_sanyuan >= 6\n        ? 8\n        : p[0] == 'z' && Math.max(n_suit.m, n_suit.p, n_suit.s) + n_suit.z >= 10\n        ? 4\n        : n_suit[p[0]] + n_suit.z >= 10\n        ? 2\n        : 1)\n    )\n  }\n\n  var self = this\n\n  if (this._lizhi[this._menfeng]) {\n    return this._shoupai._zimo + '_'\n  }\n\n  var n_xiangting = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(this._shoupai)\n  if (n_xiangting == -1) n_xiangting = 0\n\n  var anquan,\n    min = Infinity\n  if (\n    this._lizhi.filter(function(x) {\n      return x\n    }).length > 0\n  ) {\n    for (var p of this.get_dapai()) {\n      var weixian = suan_weixian(p)\n      if (weixian < min) {\n        min = weixian\n        anquan = p\n      }\n    }\n  }\n\n  var dapai,\n    max = 0,\n    max_tingpai = 0,\n    backtrack = []\n  var paishu = this._suanpai.suan_paishu_all()\n\n  for (var p of this.get_dapai()) {\n    if (!dapai) dapai = p\n    var new_shoupai = this._shoupai.clone()\n    new_shoupai.dapai(p)\n    if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) > n_xiangting) {\n      if (n_xiangting < 2) backtrack.push(p)\n      continue\n    }\n\n    var x = 1 - paijia(p) / 100 + this.eval_shoupai(new_shoupai, paishu)\n\n    var n_tingpai = 0\n    for (var tp of Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(new_shoupai)) {\n      n_tingpai += paishu[tp]\n    }\n\n    if (x >= max) {\n      max = x\n      dapai = p\n      max_tingpai = n_tingpai\n    }\n  }\n\n  var tmp_max = max\n\n  for (var p of backtrack) {\n    var new_shoupai = this._shoupai.clone()\n    new_shoupai.dapai(p)\n\n    var n_tingpai = 0\n    for (var tp of Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(new_shoupai)) {\n      n_tingpai += paishu[tp]\n    }\n    if (n_tingpai < max_tingpai * 6) continue\n\n    var x =\n      1 - paijia(p) / 100 + this.eval_backtrack(new_shoupai, paishu, tmp_max, p)\n\n    if (x >= max) {\n      max = x\n      dapai = p\n    }\n  }\n\n  if (anquan) {\n    if (n_xiangting > 1) dapai = anquan\n    else if (n_xiangting == 1 && suan_weixian(dapai) > 5) dapai = anquan\n  }\n\n  if (dapai == this._shoupai._zimo) dapai += '_'\n\n  if (this.select_lizhi(dapai)) dapai += '*'\n\n  return dapai\n}\n\nPlayer.prototype.xiangting = function(shoupai) {\n  function xiangting_menqian(shoupai) {\n    if (\n      shoupai._fulou.filter(function(m) {\n        return m.match(/[\\-\\+\\=]/)\n      }).length\n    )\n      return Infinity\n    return Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(shoupai)\n  }\n\n  function xiangting_fanpai(shoupai) {\n    var n_fanpai = 0,\n      back\n    for (var n of [self._zhuangfeng + 1, self._menfeng + 1, 5, 6, 7]) {\n      if (shoupai._bingpai.z[n] >= 3) n_fanpai++\n      else if (shoupai._bingpai.z[n] == 2 && self._suanpai.paishu('z' + n) > 0)\n        back = n\n      for (var m of shoupai._fulou) {\n        if (m[0] == 'z' && m[1] == n) n_fanpai++\n      }\n    }\n    if (n_fanpai) return Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(shoupai)\n    if (back) {\n      var new_shoupai = shoupai.clone()\n      new_shoupai._bingpai.z[back] = 0\n      new_shoupai._fulou.push('z' + n + n + n + '=')\n      return Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) + 1\n    }\n    return Infinity\n  }\n\n  function xiangting_duanyao(shoupai) {\n    if (\n      shoupai._fulou.filter(function(m) {\n        return m.match(/^z|[19]/)\n      }).length\n    )\n      return Infinity\n    var new_shoupai = shoupai.clone()\n    for (var s of ['m', 'p', 's']) {\n      for (var n of [1, 9]) {\n        new_shoupai._bingpai[s][n] = 0\n      }\n    }\n    new_shoupai._bingpai.z = [0, 0, 0, 0, 0, 0, 0, 0]\n\n    return Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai)\n  }\n\n  function xiangting_duidui(shoupai) {\n    if (\n      shoupai._fulou.filter(function(m) {\n        return !m.match(/^[mpsz](\\d)\\1\\1/)\n      }).length\n    )\n      return Infinity\n    var n_kezi = shoupai._fulou.length,\n      n_duizi = 0\n    for (var s in shoupai._bingpai) {\n      var bingpai = shoupai._bingpai[s]\n      for (var n = 1; n < bingpai.length; n++) {\n        if (bingpai[n] >= 3) n_kezi++\n        if (bingpai[n] == 2) n_duizi++\n      }\n    }\n    if (n_kezi + n_duizi > 5) n_duizi = 5 - n_kezi\n    return 8 - n_kezi * 2 - n_duizi\n  }\n\n  function xiangting_yise(shoupai, sort) {\n    var regexp = new RegExp('^[^z' + sort + ']')\n    if (\n      shoupai._fulou.filter(function(m) {\n        return m.match(regexp)\n      }).length\n    )\n      return Infinity\n    var new_shoupai = shoupai.clone()\n    for (var s of ['m', 'p', 's']) {\n      if (s != sort) new_shoupai._bingpai[s] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n    }\n    return Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai)\n  }\n\n  var self = this\n\n  return Math.min(\n    xiangting_menqian(shoupai),\n    xiangting_fanpai(shoupai),\n    xiangting_duanyao(shoupai),\n    xiangting_duidui(shoupai),\n    xiangting_yise(shoupai, 'm'),\n    xiangting_yise(shoupai, 'p'),\n    xiangting_yise(shoupai, 's')\n  )\n}\n\nPlayer.prototype.tingpai = function(shoupai) {\n  var self = this\n\n  var n_xiangting = this.xiangting(shoupai)\n\n  var pai = []\n  for (var p of Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(shoupai, function(s) {\n    return self.xiangting(s)\n  })) {\n    if (n_xiangting > 0) {\n      for (var m of get_peng_mianzi(shoupai, p + '+')) {\n        var new_shoupai = shoupai.clone()\n        new_shoupai.fulou(m)\n        if (this.xiangting(new_shoupai) < n_xiangting) {\n          pai.push(p + '+')\n          break\n        }\n      }\n      if (pai[pai.length - 1] == p + '+') continue\n\n      for (var m of get_chi_mianzi(shoupai, p + '-')) {\n        var new_shoupai = shoupai.clone()\n        new_shoupai.fulou(m)\n        if (this.xiangting(new_shoupai) < n_xiangting) {\n          pai.push(p + '-')\n          break\n        }\n      }\n      if (pai[pai.length - 1] == p + '-') continue\n    }\n    pai.push(p)\n  }\n  return pai\n}\n\nPlayer.prototype.get_defen = function(shoupai) {\n  var paistr = shoupai.toString()\n  if (this._defen_cache[paistr] != null) return this._defen_cache[paistr]\n\n  var menqian =\n    shoupai._fulou.filter(function(m) {\n      return m.match(/[\\-\\+\\=]/)\n    }).length == 0\n\n  var param = {\n    zhuangfeng: this._zhuangfeng,\n    menfeng: this._menfeng,\n    hupai: {\n      lizhi: menqian,\n      yifa: 0,\n      qianggang: false,\n      lingshang: false,\n      haidi: 0,\n      tianhu: 0,\n    },\n    baopai: this._baopai,\n    fubaopai: [],\n    jicun: { changbang: this._changbang, lizhibang: this._lizhibang },\n  }\n\n  var hule = Object(_util_hule__WEBPACK_IMPORTED_MODULE_3__[\"utilHule\"])(shoupai, null, param)\n\n  this._defen_cache[paistr] = hule.defen\n\n  return hule.defen\n}\n\nvar width = [12, 12 * 6, 12 * 6 * 3]\n\nfunction add_hongpai(pai) {\n  var new_pai = []\n  for (var p of pai) {\n    if (p[0] != 'z' && p[1] == '5') new_pai.push(p.replace(/5/, '0'))\n    new_pai.push(p)\n  }\n  return new_pai\n}\n\nPlayer.prototype.eval_shoupai = function(shoupai, paishu, dapai) {\n  var self = this\n\n  var paistr = shoupai.toString()\n  if (this._eval_cache[paistr] != null) return this._eval_cache[paistr]\n\n  var rv\n  var n_xiangting = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(shoupai)\n\n  if (n_xiangting == -1) {\n    rv = this.get_defen(shoupai)\n  } else if (shoupai._zimo) {\n    var max = 0\n    for (var p of get_dapai(shoupai)) {\n      var new_shoupai = shoupai.clone()\n      new_shoupai.dapai(p)\n      if (Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(new_shoupai) > n_xiangting) continue\n\n      var r = this.eval_shoupai(new_shoupai, paishu, dapai)\n      if (r > max) max = r\n    }\n    rv = max\n  } else if (n_xiangting < 3) {\n    var r = 0\n    for (var p of add_hongpai(Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(shoupai))) {\n      if (p == dapai) return 0\n      if (paishu[p] == 0) continue\n\n      var new_shoupai = shoupai.clone()\n      new_shoupai.zimo(p)\n\n      paishu[p]--\n      var ev = this.eval_shoupai(new_shoupai, paishu, dapai)\n      if (!dapai) {\n        if (n_xiangting > 1)\n          ev += this.eval_fulou(shoupai, p, paishu, function(s) {\n            return self.xiangting(s)\n          })\n        else if (n_xiangting > 0) ev += this.eval_fulou(shoupai, p, paishu)\n      }\n      paishu[p]++\n\n      r += ev * paishu[p]\n    }\n    rv = r / width[n_xiangting]\n  } else {\n    var r = 0\n    for (var p of add_hongpai(this.tingpai(shoupai))) {\n      if (paishu[p.substr(0, 2)] == 0) continue\n\n      r += paishu[p.substr(0, 2)] * (p[2] == '+' ? 4 : p[2] == '-' ? 2 : 1)\n    }\n    rv = r\n  }\n\n  this._eval_cache[paistr] = rv\n  return rv\n}\n\nPlayer.prototype.eval_backtrack = function(shoupai, paishu, min, dapai) {\n  var n_xiangting = Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"])(shoupai)\n\n  var r = 0\n  for (var p of add_hongpai(Object(_util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilTingpai\"])(shoupai))) {\n    if (p == dapai) continue\n    if (paishu[p] == 0) continue\n\n    var new_shoupai = shoupai.clone()\n    new_shoupai.zimo(p)\n\n    paishu[p]--\n    var ev = this.eval_shoupai(new_shoupai, paishu, dapai)\n    paishu[p]++\n\n    if (ev < min * 2) continue\n\n    r += ev * paishu[p]\n  }\n  return r / width[n_xiangting]\n}\n\nPlayer.prototype.eval_fulou = function(shoupai, p, paishu, xiangting) {\n  xiangting = xiangting || _util_xiangting__WEBPACK_IMPORTED_MODULE_2__[\"utilXiangting\"]\n\n  var n_xiangting = xiangting(shoupai)\n  if (n_xiangting <= 0) return\n\n  var r = 0,\n    peng_max = 0\n  for (var m of get_peng_mianzi(shoupai, p + '+')) {\n    var new_shoupai = shoupai.clone()\n    new_shoupai.fulou(m)\n    if (xiangting(new_shoupai) >= n_xiangting) continue\n\n    var ev = this.eval_shoupai(new_shoupai, paishu)\n    if (ev > peng_max) peng_max = ev\n  }\n\n  var chi_max = 0\n  for (var m of get_chi_mianzi(shoupai, p + '-')) {\n    var new_shoupai = shoupai.clone()\n    new_shoupai.fulou(m)\n    if (xiangting(new_shoupai) >= n_xiangting) continue\n\n    var ev = this.eval_shoupai(new_shoupai, paishu)\n    if (ev > chi_max) chi_max = ev\n  }\n\n  return peng_max > chi_max ? peng_max * 3 : peng_max * 2 + chi_max\n}\n\n\n//# sourceURL=webpack:///./js/player.js?");

/***/ }),

/***/ "./js/suanpai.js":
/*!***********************!*\
  !*** ./js/suanpai.js ***!
  \***********************/
/*! exports provided: Suanpai */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Suanpai\", function() { return Suanpai; });\n/* harmony import */ var _model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./model */ \"./js/model.js\");\n/*\n *  Suanpai\n */\n\n\n\nconst Suanpai = function(hongpai) {\n  this._paishu = {\n    m: [0, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n    p: [0, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n    s: [0, 4, 4, 4, 4, 4, 4, 4, 4, 4],\n    z: [0, 4, 4, 4, 4, 4, 4, 4],\n  }\n  if (hongpai) {\n    this._paishu.m[0] = hongpai.m\n    this._paishu.p[0] = hongpai.p\n    this._paishu.s[0] = hongpai.s\n  }\n  this._zhuangfeng = 0\n  this._menfeng = 0\n  this._baopai = []\n\n  this._dapai = []\n  for (var l = 0; l < 4; l++) {\n    this._dapai[l] = {}\n  }\n  this._lizhi = [false, false, false, false]\n}\n\nSuanpai.prototype.paishu = function(p) {\n  return this._paishu[p[0]][p[1]]\n}\n\nSuanpai.prototype.diaopai = function(p) {\n  this._paishu[p[0]][p[1]]--\n  if (p[1] == '0') this._paishu[p[0]][5]--\n}\n\nSuanpai.prototype.qipai = function(data, menfeng) {\n  this._zhuangfeng = data.zhuangfeng\n  this._menfeng = menfeng\n  this._baopai = [data.baopai]\n\n  var paistr = data.shoupai[this._menfeng]\n  for (var substr of paistr.match(/[mpsz]\\d+/g)) {\n    var s = substr[0]\n    for (var n of substr.match(/\\d/g)) {\n      this.diaopai(s + n)\n    }\n  }\n  this.diaopai(data.baopai)\n}\n\nSuanpai.prototype.zimo = function(data) {\n  if (data.l == this._menfeng) this.diaopai(data.p)\n}\n\nSuanpai.prototype.dapai = function(data) {\n  if (data.l != this._menfeng) this.diaopai(data.p)\n\n  var p = data.p.substr(0, 2).replace(/0/, '5')\n  this._dapai[data.l][p] = true\n\n  if (data.p.match(/\\*$/)) this._lizhi[data.l] = true\n  for (var l = 0; l < 4; l++) {\n    if (this._lizhi[l]) this._dapai[l][p] = true\n  }\n}\n\nSuanpai.prototype.fulou = function(data) {\n  if (data.l != this._menfeng) {\n    var s = data.m[0]\n    for (var n of data.m.match(/\\d(?![\\-\\+\\=])/g)) {\n      this.diaopai(s + n)\n    }\n  }\n}\n\nSuanpai.prototype.gang = function(data) {\n  if (data.l != this._menfeng) {\n    if (data.m.match(/^[mpsz]\\d{4}$/)) {\n      var s = data.m[0]\n      for (var n of data.m.match(/\\d/g)) {\n        this.diaopai(s + n)\n      }\n    } else {\n      var s = data.m[0],\n        n = data.m.substr(-1)\n      this.diaopai(s + n)\n    }\n  }\n}\n\nSuanpai.prototype.kaigang = function(data) {\n  this._baopai.push(data.baopai)\n  this.diaopai(data.baopai)\n}\n\nSuanpai.prototype.paijia = function(p) {\n  function weight(s, n) {\n    if (n < 1 || 9 < n) return 0\n    var rv = 1\n    for (var baopai of self._baopai) {\n      if (s + n == _model__WEBPACK_IMPORTED_MODULE_0__[\"Shan\"].zhenbaopai(baopai)) rv *= 2\n    }\n    return rv\n  }\n\n  var self = this\n\n  var rv\n  var s = p[0],\n    n = p[1] - 0 || 5\n\n  if (s == 'z') {\n    rv = this.paishu(s + n) * weight(s, n)\n  } else {\n    var left =\n      1 <= n - 2\n        ? Math.min(this.paishu(s + (n - 2)), this.paishu(s + (n - 1)))\n        : 0\n    var center =\n      1 <= n - 1 && n + 1 <= 9\n        ? Math.min(this.paishu(s + (n - 1)), this.paishu(s + (n + 1)))\n        : 0\n    var right =\n      n + 2 <= 9\n        ? Math.min(this.paishu(s + (n + 1)), this.paishu(s + (n + 2)))\n        : 0\n\n    var n_pai = [\n      left,\n      Math.max(left, center),\n      this.paishu(s + n),\n      Math.max(center, right),\n      right,\n    ]\n    var n_hongpai = this.paishu(s + '0')\n\n    rv =\n      n_pai[0] * weight(s, n - 2) +\n      n_pai[1] * weight(s, n - 1) +\n      n_pai[2] * weight(s, n) +\n      n_pai[3] * weight(s, n + 1) +\n      n_pai[4] * weight(s, n + 2)\n\n    rv +=\n      n_hongpai == 0\n        ? 0\n        : n == 7\n        ? Math.min(n_hongpai, n_pai[0]) * weight(s, n - 2)\n        : n == 6\n        ? Math.min(n_hongpai, n_pai[1]) * weight(s, n - 1)\n        : n == 5\n        ? Math.min(n_hongpai, n_pai[2]) * weight(s, n)\n        : n == 4\n        ? Math.min(n_hongpai, n_pai[3]) * weight(s, n + 1)\n        : n == 3\n        ? Math.min(n_hongpai, n_pai[4]) * weight(s, n + 2)\n        : 0\n  }\n\n  if (p[1] == '0') rv *= 2\n  if (p == 'z' + (this._zhuangfeng + 1)) rv *= 2\n  if (p == 'z' + (this._menfeng + 1)) rv *= 2\n  if (p.match(/^z[567]/)) rv *= 2\n  rv *= weight(s, n)\n\n  return rv\n}\n\nSuanpai.prototype.paijia_all = function() {\n  var paijia = { m: [], p: [], s: [], z: [] }\n  for (var s of ['m', 'p', 's', 'z']) {\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n    for (var n of nn) {\n      paijia[s][n] = this.paijia(s + n)\n    }\n  }\n  return paijia\n}\n\nSuanpai.prototype.suan_weixian = function(p, l) {\n  var s = p[0],\n    n = p[1] - 0 || 5\n\n  if (this._dapai[l][s + n]) return 0\n\n  if (s == 'z') return Math.min(this.paishu(s + n), 3)\n  if (n == 1) return this._dapai[l][s + (n + 3)] ? 3 : 6\n  if (n == 9) return this._dapai[l][s + (n - 3)] ? 3 : 6\n  if (n == 2) return this._dapai[l][s + (n + 3)] ? 4 : 8\n  if (n == 8) return this._dapai[l][s + (n - 3)] ? 4 : 8\n  if (n == 3) return this._dapai[l][s + (n + 3)] ? 5 : 8\n  if (n == 7) return this._dapai[l][s + (n - 3)] ? 5 : 8\n\n  return this._dapai[l][s + (n - 3)] && this._dapai[l][s + (n + 3)]\n    ? 4\n    : this._dapai[l][s + (n - 3)] || this._dapai[l][s + (n + 3)]\n    ? 8\n    : 12\n}\n\nSuanpai.prototype.suan_weixian_all = function(l) {\n  var weixian = { m: [], p: [], s: [], z: [] }\n  for (var s of ['m', 'p', 's', 'z']) {\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n    for (var n of nn) {\n      weixian[s][n] = this.suan_weixian(s + n, l)\n    }\n  }\n  return weixian\n}\n\nSuanpai.prototype.suan_paishu_all = function() {\n  var paishu = {}\n  for (var s of ['m', 'p', 's', 'z']) {\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n    for (var n of nn) {\n      if (s != 'z' && n == 5)\n        paishu[s + n] = this._paishu[s][n] - this._paishu[s][0]\n      else paishu[s + n] = this._paishu[s][n]\n    }\n  }\n  return paishu\n}\n\n\n//# sourceURL=webpack:///./js/suanpai.js?");

/***/ }),

/***/ "./js/ui.js":
/*!******************!*\
  !*** ./js/ui.js ***!
  \******************/
/*! exports provided: UI */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"UI\", function() { return UI; });\n/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./player */ \"./js/player.js\");\n/*\n *  UI\n */\n\n\nconst UI = function(id) {\n  _player__WEBPACK_IMPORTED_MODULE_0__[\"Player\"].call(this, id)\n  this.clear_handler()\n}\n\nUI.prototype = new _player__WEBPACK_IMPORTED_MODULE_0__[\"Player\"]()\n\nUI.prototype.clear_handler = function() {\n  $('#game').unbind('click')\n  $('.shoupai.main .bingpai .pai')\n    .unbind('click')\n    .unbind('mouseover')\n    .removeClass('blink')\n    .removeClass('selected')\n  $('.UI span')\n    .unbind('click')\n    .hide()\n  $('.UI').hide()\n}\n\nUI.prototype.wait = function(callback) {\n  var self = this\n  $('#game').bind('click', function() {\n    self.clear_handler()\n    callback()\n    return false\n  })\n}\n\nUI.prototype.get_dapai_of_lizhi = function() {\n  var dapai = []\n\n  if (!this.allow_lizhi()) return dapai\n\n  for (var p of this.get_dapai()) {\n    var new_shoupai = this._shoupai.clone()\n    new_shoupai.dapai(p)\n    if (\n      Majiang.Util.xiangting(new_shoupai) == 0 &&\n      Majiang.Util.tingpai(new_shoupai).length > 0\n    )\n      dapai.push(p)\n  }\n\n  return dapai\n}\n\nUI.prototype.action_zimo = function(data, callback, option) {\n  function set_lizhi_handler(dapai) {\n    for (var p of dapai) {\n      var selecter = '.shoupai.main .bingpai > .pai[data-pai=\"' + p + '\"]'\n      $(selecter)\n        .bind('click', p, function(event) {\n          self.clear_handler()\n          $(this).addClass('dapai')\n          callback('dapai', event.data + '*')\n          return false\n        })\n        .addClass('blink')\n\n      var selecter = '.shoupai.main .bingpai .zimo .pai[data-pai=\"' + p + '\"]'\n      $(selecter)\n        .bind('click', p, function(event) {\n          self.clear_handler()\n          $(this).addClass('dapai')\n          callback('dapai', event.data + '_*')\n          return false\n        })\n        .addClass('blink')\n    }\n  }\n\n  function set_gang_handler(mianzi) {\n    for (var m of mianzi) {\n      var p = mianzi.substr(0, 2).replace(/0/, '5')\n      var selecter = '.shoupai.main .bingpai .pai[data-pai=\"' + p + '\"]'\n      $(selecter)\n        .bind('click', m, function(event) {\n          self.clear_handler()\n          callback('gang', event.data)\n          return false\n        })\n        .addClass('blink')\n    }\n  }\n\n  var self = this\n\n  var show_botton = false\n\n  $('.UI.resize').width($('.shoupai.main .bingpai').width())\n  $('.UI').show()\n\n  if (this.allow_hule(null, option)) {\n    $('.UI .zimo')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('hule')\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  var gang_mianzi = this.get_gang_mianzi()\n  if (gang_mianzi.length == 1) {\n    $('.UI .gang')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('gang', gang_mianzi[0])\n        return false\n      })\n      .show()\n    show_botton = true\n  } else if (gang_mianzi.length > 1) {\n    $('.UI .gang')\n      .bind('click', function() {\n        self.clear_handler()\n        set_gang_handler(gang_mianzi)\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  if (this._lizhi[this._menfeng]) {\n    if (show_botton) {\n      $('#game').bind('click', function() {\n        self.clear_handler()\n        callback('dapai', data.p + '_')\n        return false\n      })\n    } else callback('dapai', data.p + '_')\n    return\n  }\n\n  var dapai = this.get_dapai_of_lizhi()\n  if (dapai.length > 0) {\n    $('.UI .lizhi')\n      .bind('click', function() {\n        self.clear_handler()\n        set_lizhi_handler(dapai)\n        return false\n      })\n      .show()\n  }\n\n  for (var p of this.get_dapai()) {\n    var selecter = '.shoupai.main .bingpai > .pai[data-pai=\"' + p + '\"]'\n    $(selecter).bind('click', p, function(event) {\n      self.clear_handler()\n      $(this).addClass('dapai')\n      callback('dapai', event.data)\n      return false\n    })\n\n    selecter = '.shoupai.main .bingpai .zimo .pai[data-pai=\"' + p + '\"]'\n    $(selecter).bind('click', p, function(event) {\n      self.clear_handler()\n      $(this).addClass('dapai')\n      callback('dapai', event.data + '_')\n      return false\n    })\n  }\n}\n\nUI.prototype.action_dapai = function(data, callback) {\n  function set_chi_handler(mianzi) {\n    function handler(event) {\n      var fulou = event.data\n      var s = fulou[0]\n      var nn = fulou.match(/\\d(?!\\-)/g)\n      var node = $('.shoupai.main .bingpai')\n      var img\n      if ($(this).data('pai') == s + nn[0])\n        img = node.find('.pai[data-pai=\"' + s + nn[1] + '\"]').eq(0)\n      else img = node.find('.pai[data-pai=\"' + s + nn[0] + '\"]').eq(-1)\n      node.find('.pai').removeClass('selected')\n      $(this).addClass('selected')\n      img.addClass('selected')\n    }\n\n    var map = {}\n    for (var m of mianzi) {\n      var s = m[0]\n      for (var n of m.match(/\\d(?!\\-)/g)) {\n        map[s + n] = m\n      }\n    }\n    for (var p in map) {\n      var selecter = '.shoupai.main .bingpai .pai[data-pai=\"' + p + '\"]'\n      $(selecter)\n        .addClass('blink')\n        .bind('mouseover', map[p], handler)\n        .bind('click', map[p], function(event) {\n          self.clear_handler\n          callback('fulou', event.data)\n          return false\n        })\n    }\n  }\n\n  var self = this\n\n  var show_botton = false\n\n  $('.UI.resize').width($('.shoupai.main .bingpai').width())\n  $('.UI').show()\n\n  if (this.allow_hule(data)) {\n    $('.UI .rong')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('hule')\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  var gang_mianzi = this.get_gang_mianzi(data)\n  if (gang_mianzi.length == 1) {\n    $('.UI .gang')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('fulou', gang_mianzi[0])\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  var peng_mianzi = this.get_peng_mianzi(data)\n  if (peng_mianzi.length == 1) {\n    $('.UI .peng')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('fulou', peng_mianzi[0])\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  var chi_mianzi = this.get_chi_mianzi(data)\n  if (chi_mianzi.length == 1) {\n    $('.UI .chi')\n      .bind('click', function() {\n        callback('fulou', chi_mianzi[0])\n        self.clear_handler()\n        return false\n      })\n      .show()\n    show_botton = true\n  } else if (chi_mianzi.length > 1) {\n    $('.UI .chi')\n      .bind('click', function() {\n        self.clear_handler()\n        set_chi_handler(chi_mianzi)\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  if (show_botton) {\n    $('#game').bind('click', function() {\n      self.clear_handler()\n      callback()\n      return false\n    })\n  } else callback()\n}\n\nUI.prototype.action_fulou = function(data, callback) {\n  var self = this\n\n  var show_botton = false\n\n  $('.UI.resize').width($('.shoupai.main .bingpai').width())\n  $('.UI').show()\n\n  for (var p of this.get_dapai()) {\n    var selecter = '.shoupai.main .bingpai > .pai[data-pai=\"' + p + '\"]'\n    $(selecter).bind('click', p, function(event) {\n      self.clear_handler()\n      $(this).addClass('dapai')\n      callback('dapai', event.data)\n      return false\n    })\n\n    selecter = '.shoupai.main .bingpai .zimo .pai[data-pai=\"' + p + '\"]'\n    $(selecter).bind('click', p, function(event) {\n      self.clear_handler()\n      $(this).addClass('dapai')\n      callback('dapai', event.data + '_')\n      return false\n    })\n  }\n}\n\nUI.prototype.action_gang = function(data, callback) {\n  var self = this\n\n  var show_botton = false\n\n  $('.UI.resize').width($('.shoupai.main .bingpai').width())\n  $('.UI').show()\n\n  if (this.allow_hule(data, 'qianggang')) {\n    $('.UI .rong')\n      .bind('click', function() {\n        self.clear_handler()\n        callback('hule')\n        return false\n      })\n      .show()\n    show_botton = true\n  }\n\n  if (show_botton) {\n    $('#game').bind('click', function() {\n      self.clear_handler()\n      callback()\n      return false\n    })\n  } else callback()\n}\n\n\n//# sourceURL=webpack:///./js/ui.js?");

/***/ }),

/***/ "./js/util/hule.js":
/*!*************************!*\
  !*** ./js/util/hule.js ***!
  \*************************/
/*! exports provided: utilHule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utilHule\", function() { return utilHule; });\n/* harmony import */ var _model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../model */ \"./js/model.js\");\n/*\n *  hule\n */\n\n\nfunction mianzi(s, bingpai, n) {\n  if (n > 9) return [[]]\n\n  if (bingpai[n] == 0) return mianzi(s, bingpai, n + 1)\n\n  var shunzi = []\n  if (n <= 7 && bingpai[n] > 0 && bingpai[n + 1] > 0 && bingpai[n + 2] > 0) {\n    bingpai[n]--\n    bingpai[n + 1]--\n    bingpai[n + 2]--\n    shunzi = mianzi(s, bingpai, n)\n    bingpai[n]++\n    bingpai[n + 1]++\n    bingpai[n + 2]++\n    for (var s_mianzi of shunzi) {\n      s_mianzi.unshift(s + n + (n + 1) + (n + 2))\n    }\n  }\n\n  var kezi = []\n  if (bingpai[n] >= 3) {\n    bingpai[n] -= 3\n    kezi = mianzi(s, bingpai, n)\n    bingpai[n] += 3\n    for (var k_mianzi of kezi) {\n      k_mianzi.unshift(s + n + n + n)\n    }\n  }\n\n  return shunzi.concat(kezi)\n}\n\nfunction mianzi_all(shoupai) {\n  var all_mianzi = [[]]\n\n  for (var s of ['m', 'p', 's']) {\n    var new_mianzi = []\n    var sub_mianzi = mianzi(s, shoupai._bingpai[s], 1)\n    for (var mm of all_mianzi) {\n      for (var nn of sub_mianzi) {\n        new_mianzi.push(mm.concat(nn))\n      }\n    }\n    all_mianzi = new_mianzi\n  }\n\n  var sub_mianzi_z = []\n  for (var n = 1; n <= 7; n++) {\n    if (shoupai._bingpai.z[n] == 0) continue\n    if (shoupai._bingpai.z[n] != 3) return []\n    sub_mianzi_z.push('z' + n + n + n)\n  }\n\n  var fulou = shoupai._fulou.map(function(m) {\n    return m.replace(/0/g, '5')\n  })\n  for (var i = 0; i < all_mianzi.length; i++) {\n    all_mianzi[i] = all_mianzi[i].concat(sub_mianzi_z).concat(fulou)\n  }\n\n  return all_mianzi\n}\n\nfunction add_hulepai(hule_mianzi, p) {\n  var regexp = new RegExp('^(' + p[0] + '.*' + (p[1] || '5') + ')')\n  var replacer = '$1' + p[2] + '!'\n\n  var new_mianzi = []\n\n  for (var i = 0; i < hule_mianzi.length; i++) {\n    if (hule_mianzi[i].match(/[\\-\\+\\=]/)) continue\n    if (i > 0 && hule_mianzi[i] == hule_mianzi[i - 1]) continue\n    var m = hule_mianzi[i].replace(regexp, replacer)\n    if (m == hule_mianzi[i]) continue\n    var tmp_mianzi = hule_mianzi.concat()\n    tmp_mianzi[i] = m\n    new_mianzi.push(tmp_mianzi)\n  }\n\n  return new_mianzi\n}\n\nfunction hule_mianzi_yiban(shoupai, hulepai) {\n  var hule_mianzi = []\n\n  for (var s in shoupai._bingpai) {\n    var bingpai = shoupai._bingpai[s]\n    for (var n = 1; n < bingpai.length; n++) {\n      if (bingpai[n] < 2) continue\n      bingpai[n] -= 2\n      var jiangpai = s + n + n\n      for (var mm of mianzi_all(shoupai)) {\n        mm.unshift(jiangpai)\n        if (mm.length != 5) continue\n        hule_mianzi = hule_mianzi.concat(add_hulepai(mm, hulepai))\n      }\n      bingpai[n] += 2\n    }\n  }\n\n  return hule_mianzi\n}\n\nfunction hule_mianzi_qiduizi(shoupai, hulepai) {\n  var mianzi = []\n\n  for (var s in shoupai._bingpai) {\n    var bingpai = shoupai._bingpai[s]\n    for (var n = 1; n < bingpai.length; n++) {\n      if (bingpai[n] == 0) continue\n      if (bingpai[n] == 2) {\n        var p =\n          s + n == hulepai.substr(0, 2)\n            ? s + n + n + hulepai[2] + '!'\n            : s + n + n\n        mianzi.push(p)\n      } else return []\n    }\n  }\n\n  return mianzi.length == 7 ? [mianzi] : []\n}\n\nfunction hule_mianzi_guoshi(shoupai, hulepai) {\n  var mianzi = []\n\n  if (shoupai._fulou.length > 0) return mianzi\n\n  var you_duizi = false\n  for (var s in shoupai._bingpai) {\n    var bingpai = shoupai._bingpai[s]\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [1, 9]\n    for (var n of nn) {\n      if (bingpai[n] == 2) {\n        var p =\n          s + n == hulepai.substr(0, 2)\n            ? s + n + n + hulepai[2] + '!'\n            : s + n + n\n        mianzi.unshift(p)\n        you_duizi = true\n      } else if (bingpai[n] == 1) {\n        var p = s + n == hulepai.substr(0, 2) ? s + n + hulepai[2] + '!' : s + n\n        mianzi.push(p)\n      } else return []\n    }\n  }\n\n  return you_duizi ? [mianzi] : []\n}\n\nfunction hule_mianzi_jiulian(shoupai, hulepai) {\n  var s = hulepai[0]\n  if (!s.match(/^[mps]$/)) return []\n\n  var mianzi = s\n  var bingpai = shoupai._bingpai[s]\n  for (var n = 1; n <= 9; n++) {\n    if ((n == 1 || n == 9) && bingpai[n] < 3) return []\n    if (bingpai[n] == 0) return []\n    var nn = n == hulepai[1] ? bingpai[n] - 1 : bingpai[n]\n    for (var i = 0; i < nn; i++) {\n      mianzi += n\n    }\n  }\n  if (mianzi.length != 14) return []\n  mianzi += hulepai.substr(1) + '!'\n\n  return [[mianzi]]\n}\n\nfunction hule_mianzi(shoupai, rongpai) {\n  var hulepai = rongpai || shoupai._zimo + '_'\n  hulepai = hulepai.replace(/0/, '5')\n\n  return []\n    .concat(hule_mianzi_yiban(shoupai, hulepai))\n    .concat(hule_mianzi_qiduizi(shoupai, hulepai))\n    .concat(hule_mianzi_guoshi(shoupai, hulepai))\n    .concat(hule_mianzi_jiulian(shoupai, hulepai))\n}\n\nfunction get_hudi(mianzi, zhuangfeng, menfeng) {\n  var zhuangfengpai = new RegExp('^z' + (zhuangfeng + 1) + '.*$')\n  var menfengpai = new RegExp('^z' + (menfeng + 1) + '.*$')\n  var sanyuanpai = /^z[567].*$/\n\n  var yaojiu = /^.*[z19].*$/\n  var zipai = /^z.*$/\n\n  var kezi = /^[mpsz](\\d)\\1\\1.*$/\n  var ankezi = /^[mpsz](\\d)\\1\\1(?:\\1|_\\!)?$/\n  var gangzi = /^[mpsz](\\d)\\1\\1.*\\1.*$/\n\n  var danqi = /^[mpsz](\\d)\\1[\\-\\+\\=\\_]\\!$/\n  var kanzhang = /^[mps]\\d\\d[\\-\\+\\=\\_]\\!\\d$/\n  var bianzhang = /^[mps](123[\\-\\+\\=\\_]\\!|7[\\-\\+\\=\\_]\\!89)$/\n\n  var hudi = {\n    fu: 20,\n    menqian: true,\n    zimo: true,\n    shunzi: { m: {}, p: {}, s: {} },\n    kezi: {\n      m: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n      p: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n      s: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n      z: [0, 0, 0, 0, 0, 0, 0, 0],\n    },\n    n_shunzi: 0,\n    n_kezi: 0,\n    n_ankezi: 0,\n    n_gangzi: 0,\n    n_zipai: 0,\n    n_yaojiu: 0,\n    danqi: false,\n    pinghu: false,\n    zhuangfeng: zhuangfeng,\n    menfeng: menfeng,\n  }\n\n  for (var m of mianzi) {\n    if (m.match(/[\\-\\+\\=]\\!/)) hudi.zimo = false\n    if (m.match(/[\\-\\+\\=](?!\\!)/)) hudi.menqian = false\n\n    if (m.match(yaojiu)) hudi.n_yaojiu++\n    if (m.match(zipai)) hudi.n_zipai++\n\n    if (m.match(danqi)) hudi.danqi = true\n\n    if (mianzi.length != 5) continue\n\n    if (m == mianzi[0]) {\n      var fu = 0\n      if (m.match(zhuangfengpai)) fu += 2\n      if (m.match(menfengpai)) fu += 2\n      if (m.match(sanyuanpai)) fu += 2\n      hudi.fu += fu\n      if (hudi.danqi) hudi.fu += 2\n    } else if (m.match(kezi)) {\n      hudi.n_kezi++\n      var fu = 2\n      if (m.match(yaojiu)) {\n        fu *= 2\n      }\n      if (m.match(ankezi)) {\n        fu *= 2\n        hudi.n_ankezi++\n      }\n      if (m.match(gangzi)) {\n        fu *= 4\n        hudi.n_gangzi++\n      }\n      hudi.fu += fu\n      hudi.kezi[m[0]][m[1]] = 1\n    } else {\n      hudi.n_shunzi++\n      if (m.match(kanzhang)) hudi.fu += 2\n      if (m.match(bianzhang)) hudi.fu += 2\n      var nnn = m.replace(/[^\\d]/g, '')\n      if (!hudi.shunzi[m[0]][nnn]) hudi.shunzi[m[0]][nnn] = 1\n      else hudi.shunzi[m[0]][nnn]++\n    }\n  }\n\n  if (mianzi.length == 7) {\n    hudi.fu = 25\n  } else if (mianzi.length == 5) {\n    hudi.pinghu = hudi.menqian && hudi.fu == 20\n    if (hudi.zimo) {\n      if (!hudi.pinghu) hudi.fu += 2\n    } else {\n      if (hudi.menqian) hudi.fu += 10\n      else if (hudi.fu == 20) hudi.fu = 30\n    }\n    hudi.fu = Math.ceil(hudi.fu / 10) * 10\n  }\n\n  return hudi\n}\n\nfunction get_pre_hupai(hupai) {\n  var pre_hupai = []\n\n  if (hupai.lizhi == 1) pre_hupai.push({ name: '立直', fanshu: 1 })\n  if (hupai.lizhi == 2) pre_hupai.push({ name: 'ダブル立直', fanshu: 2 })\n  if (hupai.yifa) pre_hupai.push({ name: '一発', fanshu: 1 })\n  if (hupai.haidi == 1) pre_hupai.push({ name: '海底摸月', fanshu: 1 })\n  if (hupai.haidi == 2) pre_hupai.push({ name: '河底撈魚', fanshu: 1 })\n  if (hupai.lingshang) pre_hupai.push({ name: '嶺上開花', fanshu: 1 })\n  if (hupai.qianggang) pre_hupai.push({ name: '槍槓', fanshu: 1 })\n\n  if (hupai.tianhu == 1) pre_hupai = [{ name: '天和', fanshu: '*' }]\n  if (hupai.tianhu == 2) pre_hupai = [{ name: '地和', fanshu: '*' }]\n\n  return pre_hupai\n}\n\nfunction get_hupai(mianzi, hudi, pre_hupai) {\n  function menqianqing() {\n    if (hudi.menqian && hudi.zimo) return [{ name: '門前清自摸和', fanshu: 1 }]\n    return []\n  }\n  function fanpai() {\n    var feng_hanzi = ['東', '南', '西', '北']\n    var fanpai_all = []\n    if (hudi.kezi.z[hudi.zhuangfeng + 1])\n      fanpai_all.push({\n        name: '場風 ' + feng_hanzi[hudi.zhuangfeng],\n        fanshu: 1,\n      })\n    if (hudi.kezi.z[hudi.menfeng + 1])\n      fanpai_all.push({ name: '自風 ' + feng_hanzi[hudi.menfeng], fanshu: 1 })\n    if (hudi.kezi.z[5]) fanpai_all.push({ name: '翻牌 白', fanshu: 1 })\n    if (hudi.kezi.z[6]) fanpai_all.push({ name: '翻牌 發', fanshu: 1 })\n    if (hudi.kezi.z[7]) fanpai_all.push({ name: '翻牌 中', fanshu: 1 })\n    return fanpai_all\n  }\n  function pinghu() {\n    if (hudi.pinghu) return [{ name: '平和', fanshu: 1 }]\n    return []\n  }\n  function duanyaojiu() {\n    if (hudi.n_yaojiu == 0) return [{ name: '断幺九', fanshu: 1 }]\n    return []\n  }\n  function yibeikou() {\n    if (!hudi.menqian) return []\n    var beikou = 0\n    for (var s in hudi.shunzi) {\n      for (var m in hudi.shunzi[s]) {\n        if (hudi.shunzi[s][m] > 3) beikou++\n        if (hudi.shunzi[s][m] > 1) beikou++\n      }\n    }\n    if (beikou == 1) return [{ name: '一盃口', fanshu: 1 }]\n    return []\n  }\n  function sansetongshun() {\n    var shunzi = hudi.shunzi\n    for (var m in shunzi.m) {\n      if (shunzi.p[m] && shunzi.s[m])\n        return [{ name: '三色同順', fanshu: hudi.menqian ? 2 : 1 }]\n    }\n    return []\n  }\n  function yiqitongguan() {\n    var shunzi = hudi.shunzi\n    for (var s in shunzi) {\n      if (shunzi[s][123] && shunzi[s][456] && shunzi[s][789])\n        return [{ name: '一気通貫', fanshu: hudi.menqian ? 2 : 1 }]\n    }\n    return []\n  }\n  function hunquandaiyaojiu() {\n    if (hudi.n_yaojiu == 5 && hudi.n_shunzi > 0 && hudi.n_zipai > 0)\n      return [{ name: '混全帯幺九', fanshu: hudi.menqian ? 2 : 1 }]\n    return []\n  }\n  function qiduizi() {\n    if (mianzi.length == 7) return [{ name: '七対子', fanshu: 2 }]\n    return []\n  }\n  function duiduihu() {\n    if (hudi.n_kezi == 4) return [{ name: '対々和', fanshu: 2 }]\n    return []\n  }\n  function sananke() {\n    if (hudi.n_ankezi == 3) return [{ name: '三暗刻', fanshu: 2 }]\n    return []\n  }\n  function sangangzi() {\n    if (hudi.n_gangzi == 3) return [{ name: '三槓子', fanshu: 2 }]\n    return []\n  }\n  function sansetongke() {\n    var kezi = hudi.kezi\n    for (var n = 1; n <= 9; n++) {\n      if (kezi.m[n] + kezi.p[n] + kezi.s[n] == 3)\n        return [{ name: '三色同刻', fanshu: 2 }]\n    }\n    return []\n  }\n  function hunlaotou() {\n    if (\n      hudi.n_yaojiu == mianzi.length &&\n      hudi.n_shunzi == 0 &&\n      hudi.n_zipai > 0\n    )\n      return [{ name: '混老頭', fanshu: 2 }]\n    return []\n  }\n  function xiaosanyuan() {\n    if (\n      hudi.kezi.z[5] + hudi.kezi.z[6] + hudi.kezi.z[7] == 2 &&\n      mianzi[0].match(/^z[567]/)\n    )\n      return [{ name: '小三元', fanshu: 2 }]\n    return []\n  }\n  function hunyise() {\n    for (var s of ['m', 'p', 's']) {\n      var yise = new RegExp('^[z' + s + '].*$')\n      if (\n        mianzi.filter(function(m) {\n          return m.match(yise)\n        }).length == mianzi.length &&\n        hudi.n_zipai > 0\n      )\n        return [{ name: '混一色', fanshu: hudi.menqian ? 3 : 2 }]\n    }\n    return []\n  }\n  function chunquandaiyaojiu() {\n    if (hudi.n_yaojiu == 5 && hudi.n_shunzi > 0 && hudi.n_zipai == 0)\n      return [{ name: '純全帯幺九', fanshu: hudi.menqian ? 3 : 2 }]\n    return []\n  }\n  function erbeikou() {\n    if (!hudi.menqian) return []\n    var beikou = 0\n    for (var s in hudi.shunzi) {\n      for (var m in hudi.shunzi[s]) {\n        if (hudi.shunzi[s][m] > 3) beikou++\n        if (hudi.shunzi[s][m] > 1) beikou++\n      }\n    }\n    if (beikou == 2) return [{ name: '二盃口', fanshu: 3 }]\n    return []\n  }\n  function qingyise() {\n    for (var s of ['m', 'p', 's']) {\n      var yise = new RegExp('^[z' + s + '].*$')\n      if (\n        mianzi.filter(function(m) {\n          return m.match(yise)\n        }).length == mianzi.length &&\n        hudi.n_zipai == 0\n      )\n        return [{ name: '清一色', fanshu: hudi.menqian ? 6 : 5 }]\n    }\n    return []\n  }\n\n  function guoshiwushuang() {\n    if (mianzi.length != 13) return []\n    if (hudi.danqi) return [{ name: '国士無双十三面', fanshu: '**' }]\n    else return [{ name: '国士無双', fanshu: '*' }]\n  }\n  function sianke() {\n    if (hudi.n_ankezi != 4) return []\n    if (hudi.danqi) return [{ name: '四暗刻単騎', fanshu: '**' }]\n    else return [{ name: '四暗刻', fanshu: '*' }]\n  }\n  function dasanyuan() {\n    if (hudi.kezi.z[5] + hudi.kezi.z[6] + hudi.kezi.z[7] == 3) {\n      var bao_mianzi = mianzi.filter(function(m) {\n        return m.match(/^z([567])\\1\\1(?:[\\-\\+\\=]|\\1)(?!\\!)/)\n      })\n      var baojia = bao_mianzi[2] && bao_mianzi[2].match(/[\\-\\+\\=]/)\n      return [{ name: '大三元', fanshu: '*', baojia: baojia && baojia[0] }]\n    }\n    return []\n  }\n  function sixihu() {\n    var kezi = hudi.kezi\n    if (kezi.z[1] + kezi.z[2] + kezi.z[3] + kezi.z[4] == 4) {\n      var bao_mianzi = mianzi.filter(function(m) {\n        return m.match(/^z([1234])\\1\\1(?:[\\-\\+\\=]|\\1)(?!\\!)/)\n      })\n      var baojia = bao_mianzi[3] && bao_mianzi[3].match(/[\\-\\+\\=]/)\n      return [{ name: '大四喜', fanshu: '**', baojia: baojia && baojia[0] }]\n    }\n    if (\n      kezi.z[1] + kezi.z[2] + kezi.z[3] + kezi.z[4] == 3 &&\n      mianzi[0].match(/^z[1234]/)\n    )\n      return [{ name: '小四喜', fanshu: '*' }]\n    return []\n  }\n  function ziyise() {\n    if (hudi.n_zipai == mianzi.length) return [{ name: '字一色', fanshu: '*' }]\n    return []\n  }\n  function lvyise() {\n    if (\n      mianzi.filter(function(m) {\n        return m.match(/^[mp]/)\n      }).length > 0\n    )\n      return []\n    if (\n      mianzi.filter(function(m) {\n        return m.match(/^z[^6]/)\n      }).length > 0\n    )\n      return []\n    if (\n      mianzi.filter(function(m) {\n        return m.match(/^s.*[1579]/)\n      }).length > 0\n    )\n      return []\n    return [{ name: '緑一色', fanshu: '*' }]\n  }\n  function qinglaotou() {\n    if (hudi.n_kezi == 4 && hudi.n_yaojiu == 5 && hudi.n_zipai == 0)\n      return [{ name: '清老頭', fanshu: '*' }]\n    return []\n  }\n  function sigangzi() {\n    if (hudi.n_gangzi == 4) return [{ name: '四槓子', fanshu: '*' }]\n    return []\n  }\n  function jiulianbaodeng() {\n    if (mianzi.length != 1) return []\n    if (mianzi[0].match(/^[mps]1112345678999/))\n      return [{ name: '純正九蓮宝燈', fanshu: '**' }]\n    else return [{ name: '九蓮宝燈', fanshu: '*' }]\n  }\n\n  var damanguan =\n    pre_hupai.length > 0 && pre_hupai[0].fanshu[0] == '*' ? pre_hupai : []\n  damanguan = damanguan\n    .concat(guoshiwushuang())\n    .concat(sianke())\n    .concat(dasanyuan())\n    .concat(sixihu())\n    .concat(ziyise())\n    .concat(lvyise())\n    .concat(qinglaotou())\n    .concat(sigangzi())\n    .concat(jiulianbaodeng())\n\n  if (damanguan.length > 0) return damanguan\n  else\n    return pre_hupai\n      .concat(menqianqing())\n      .concat(fanpai())\n      .concat(pinghu())\n      .concat(duanyaojiu())\n      .concat(yibeikou())\n      .concat(sansetongshun())\n      .concat(yiqitongguan())\n      .concat(hunquandaiyaojiu())\n      .concat(qiduizi())\n      .concat(duiduihu())\n      .concat(sananke())\n      .concat(sangangzi())\n      .concat(sansetongke())\n      .concat(hunlaotou())\n      .concat(xiaosanyuan())\n      .concat(hunyise())\n      .concat(chunquandaiyaojiu())\n      .concat(erbeikou())\n      .concat(qingyise())\n}\n\nfunction get_post_hupai(paistr, baopai, fubaopai) {\n  var post_hupai = []\n\n  var substr = paistr.match(/[mpsz][^mpsz,]*/g) || []\n\n  var n_baopai = 0\n  for (var p of baopai) {\n    p = _model__WEBPACK_IMPORTED_MODULE_0__[\"Shan\"].zhenbaopai(p)\n    var regexp = new RegExp(p[1], 'g')\n    for (var str of substr) {\n      if (str[0] != p[0]) continue\n      str = str.replace(/0/, '5')\n      var nn = str.match(regexp)\n      if (nn) n_baopai += nn.length\n    }\n  }\n  if (n_baopai) post_hupai.push({ name: 'ドラ', fanshu: n_baopai })\n\n  var n_hongpai = 0\n  var nn = paistr.match(/0/g)\n  if (nn) n_hongpai = nn.length\n  if (n_hongpai) post_hupai.push({ name: '赤ドラ', fanshu: n_hongpai })\n\n  var n_fubaopai = 0\n  for (var p of fubaopai) {\n    p = _model__WEBPACK_IMPORTED_MODULE_0__[\"Shan\"].zhenbaopai(p)\n    var regexp = new RegExp(p[1], 'g')\n    for (var str of substr) {\n      if (str[0] != p[0]) continue\n      str = str.replace(/0/, '5')\n      var nn = str.match(regexp)\n      if (nn) n_fubaopai += nn.length\n    }\n  }\n  if (n_fubaopai) post_hupai.push({ name: '裏ドラ', fanshu: n_fubaopai })\n\n  return post_hupai\n}\n\nconst utilHule = function(shoupai, rongpai, param) {\n  var max = {\n    hupai: null,\n    fu: 0,\n    fanshu: 0,\n    damanguan: 0,\n    defen: 0,\n    fenpei: [0, 0, 0, 0],\n  }\n\n  var pre_hupai = get_pre_hupai(param.hupai)\n  var post_hupai = get_post_hupai(\n    shoupai.toString(),\n    param.baopai,\n    param.fubaopai\n  )\n\n  for (var mianzi of hule_mianzi(shoupai, rongpai)) {\n    var hudi = get_hudi(mianzi, param.zhuangfeng, param.menfeng)\n    var hupai = get_hupai(mianzi, hudi, pre_hupai)\n\n    if (hupai.length == 0) continue\n\n    var fu = hudi.fu\n    var fanshu = 0,\n      defen = 0,\n      damanguan = 0\n\n    var baojia2,\n      defen2 = 0\n\n    if (hupai[0].fanshu[0] == '*') {\n      for (var h of hupai) {\n        damanguan += h.fanshu.match(/\\*/g).length\n        if (h.baojia) {\n          baojia2 =\n            h.baojia == '+'\n              ? (param.menfeng + 1) % 4\n              : h.baojia == '='\n              ? (param.menfeng + 2) % 4\n              : h.baojia == '-'\n              ? (param.menfeng + 3) % 4\n              : -1\n          defen2 = 8000 * h.fanshu.match(/\\*/g).length\n        }\n      }\n      defen = 8000 * damanguan\n    } else {\n      hupai = hupai.concat(post_hupai)\n      for (var h of hupai) {\n        fanshu += h.fanshu\n      }\n      if (fanshu >= 13) defen = 8000\n      else if (fanshu >= 11) defen = 6000\n      else if (fanshu >= 8) defen = 4000\n      else if (fanshu >= 6) defen = 3000\n      else {\n        defen = fu * 2 * 2\n        for (var i = 0; i < fanshu; i++) {\n          defen *= 2\n        }\n        if (defen >= 2000) defen = 2000\n      }\n    }\n\n    var fenpei = [0, 0, 0, 0]\n\n    if (defen2 > 0) {\n      if (rongpai) defen2 = defen2 / 2\n      defen = defen - defen2\n      defen2 = defen2 * (param.menfeng == 0 ? 6 : 4)\n      fenpei[param.menfeng] = defen2\n      fenpei[baojia2] = -defen2\n    }\n\n    var changbang = param.jicun.changbang\n    var lizhibang = param.jicun.lizhibang\n\n    if (rongpai || defen == 0) {\n      var baojia =\n        defen == 0\n          ? baojia2\n          : rongpai[2] == '+'\n          ? (param.menfeng + 1) % 4\n          : rongpai[2] == '='\n          ? (param.menfeng + 2) % 4\n          : rongpai[2] == '-'\n          ? (param.menfeng + 3) % 4\n          : -1\n      defen = Math.ceil((defen * (param.menfeng == 0 ? 6 : 4)) / 100) * 100\n      fenpei[param.menfeng] += defen + changbang * 300 + lizhibang * 1000\n      fenpei[baojia] += -defen - changbang * 300\n    } else {\n      var zhuangjia = Math.ceil((defen * 2) / 100) * 100\n      var sanjia = Math.ceil(defen / 100) * 100\n      if (param.menfeng == 0) {\n        defen = zhuangjia * 3\n        for (var l = 0; l < 4; l++) {\n          if (l == param.menfeng)\n            fenpei[l] += defen + changbang * 300 + lizhibang * 1000\n          else fenpei[l] += -zhuangjia - changbang * 100\n        }\n      } else {\n        defen = zhuangjia + sanjia * 2\n        for (var l = 0; l < 4; l++) {\n          if (l == param.menfeng)\n            fenpei[l] += defen + changbang * 300 + lizhibang * 1000\n          else if (l == 0) fenpei[l] += -zhuangjia - changbang * 100\n          else fenpei[l] += -sanjia - changbang * 100\n        }\n      }\n    }\n\n    if (\n      defen + defen2 > max.defen ||\n      (defen + defen2 == max.defen &&\n        (!fanshu ||\n          fanshu > max.fanshu ||\n          (fanshu == max.fanshu && fu > max.fu)))\n    ) {\n      max = {\n        hupai: hupai,\n        fu: fu,\n        fanshu: fanshu,\n        damanguan: damanguan,\n        defen: defen + defen2,\n        fenpei: fenpei,\n      }\n    }\n  }\n\n  return max\n}\n\n\n//# sourceURL=webpack:///./js/util/hule.js?");

/***/ }),

/***/ "./js/util/xiangting.js":
/*!******************************!*\
  !*** ./js/util/xiangting.js ***!
  \******************************/
/*! exports provided: utilXiangting, utilTingpai */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utilXiangting\", function() { return utilXiangting; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utilTingpai\", function() { return utilTingpai; });\n// 功能函数 检测向听数 多处用到\n\n/*\n *  Majiang.Util.xiangting\n */\n\nfunction _xiangting(m, d, g, j) {\n  var n = j ? 4 : 5\n  if (m > 4) {\n    d += m - 4\n    m = 4\n  }\n  if (m + d > 4) {\n    g += m + d - 4\n    d = 4 - m\n  }\n  if (m + d + g > n) {\n    g = n - m - d\n  }\n  if (j) d++\n  return 13 - m * 3 - d * 2 - g\n}\n\nfunction dazi(bingpai) {\n  var n_pai = 0,\n    n_dazi = 0,\n    n_guli = 0\n\n  for (var n = 1; n <= 9; n++) {\n    n_pai += bingpai[n]\n    if (n <= 7 && bingpai[n + 1] == 0 && bingpai[n + 2] == 0) {\n      n_dazi += n_pai >> 1\n      n_guli += n_pai % 2\n      n_pai = 0\n    }\n  }\n  n_dazi += n_pai >> 1\n  n_guli += n_pai % 2\n\n  return [[0, n_dazi, n_guli], [0, n_dazi, n_guli]]\n}\n\nfunction mianzi(bingpai, n) {\n  if (n > 9) return dazi(bingpai)\n\n  var max = mianzi(bingpai, n + 1)\n\n  if (n <= 7 && bingpai[n] > 0 && bingpai[n + 1] > 0 && bingpai[n + 2] > 0) {\n    bingpai[n]--\n    bingpai[n + 1]--\n    bingpai[n + 2]--\n    var r = mianzi(bingpai, n)\n    bingpai[n]++\n    bingpai[n + 1]++\n    bingpai[n + 2]++\n    r[0][0]++\n    r[1][0]++\n    if (r[0][0] * 2 + r[0][1] > max[0][0] * 2 + max[0][1]) max[0] = r[0]\n    if (r[1][0] * 10 + r[1][1] > max[1][0] * 10 + max[1][1]) max[1] = r[1]\n  }\n\n  if (bingpai[n] >= 3) {\n    bingpai[n] -= 3\n    var r = mianzi(bingpai, n)\n    bingpai[n] += 3\n    r[0][0]++\n    r[1][0]++\n    if (r[0][0] * 2 + r[0][1] > max[0][0] * 2 + max[0][1]) max[0] = r[0]\n    if (r[1][0] * 10 + r[1][1] > max[1][0] * 10 + max[1][1]) max[1] = r[1]\n  }\n\n  return max\n}\n\nfunction mianzi_all(shoupai, jiangpai) {\n  var r = {}\n\n  r.m = mianzi(shoupai._bingpai.m, 1)\n  r.p = mianzi(shoupai._bingpai.p, 1)\n  r.s = mianzi(shoupai._bingpai.s, 1)\n\n  var z = [0, 0, 0]\n  for (var n = 1; n <= 7; n++) {\n    if (shoupai._bingpai.z[n] >= 3) z[0]++\n    if (shoupai._bingpai.z[n] == 2) z[1]++\n    if (shoupai._bingpai.z[n] == 1) z[2]++\n  }\n\n  var n_fulou = shoupai._fulou.length\n\n  var min_xiangting = 13\n\n  for (var m of r.m) {\n    for (var p of r.p) {\n      for (var s of r.s) {\n        var n_mianzi = m[0] + p[0] + s[0] + z[0] + n_fulou\n        var n_dazi = m[1] + p[1] + s[1] + z[1]\n        var n_guli = m[2] + p[2] + s[2] + z[2]\n        var xiangting = _xiangting(n_mianzi, n_dazi, n_guli, jiangpai)\n        if (xiangting < min_xiangting) min_xiangting = xiangting\n      }\n    }\n  }\n\n  return min_xiangting\n}\n\nfunction xiangting_yiban(shoupai) {\n  var min_xiangting = mianzi_all(shoupai)\n\n  for (var s of ['m', 'p', 's', 'z']) {\n    for (var n = 1; n <= shoupai._bingpai[s].length; n++) {\n      if (shoupai._bingpai[s][n] >= 2) {\n        shoupai._bingpai[s][n] -= 2\n        var xiangting = mianzi_all(shoupai, true)\n        shoupai._bingpai[s][n] += 2\n        if (xiangting < min_xiangting) min_xiangting = xiangting\n      }\n    }\n  }\n\n  return min_xiangting\n}\n\nfunction xiangting_guoshi(shoupai) {\n  var n_yaojiu = 0\n  var you_duizi = false\n\n  for (var s in shoupai._bingpai) {\n    var bingpai = shoupai._bingpai[s]\n    var nn = s == 'z' ? [1, 2, 3, 4, 5, 6, 7] : [1, 9]\n    for (var n of nn) {\n      if (bingpai[n] > 0) n_yaojiu++\n      if (bingpai[n] > 1) you_duizi = true\n    }\n  }\n\n  return you_duizi ? 12 - n_yaojiu : 13 - n_yaojiu\n}\n\nfunction xiangting_qiduizi(shoupai) {\n  var n_duizi = 0\n  var n_danqi = 0\n\n  for (var s of ['m', 'p', 's', 'z']) {\n    var bingpai = shoupai._bingpai[s]\n    for (var n = 1; n < bingpai.length; n++) {\n      if (bingpai[n] >= 2) n_duizi++\n      else if (bingpai[n] == 1) n_danqi++\n    }\n  }\n\n  if (n_duizi > 7) n_duizi = 7\n  if (n_duizi + n_danqi > 7) n_danqi = 7 - n_duizi\n\n  return 13 - n_duizi * 2 - n_danqi\n}\n\nconst $xiangting = function(shoupai) {\n  var min_xiangting = xiangting_yiban(shoupai)\n\n  if (shoupai._fulou.length == 0) {\n    var xiangting = xiangting_qiduizi(shoupai)\n    if (xiangting < min_xiangting) min_xiangting = xiangting\n\n    var xiangting = xiangting_guoshi(shoupai)\n    if (xiangting < min_xiangting) min_xiangting = xiangting\n  }\n\n  return min_xiangting\n}\n\nconst utilXiangting = $xiangting\n\nconst utilTingpai = function(shoupai, xiangting) {\n  var pai = []\n\n  if (shoupai._zimo) return pai\n\n  xiangting = xiangting || $xiangting\n\n  var n_xiangting = xiangting(shoupai)\n  for (var s of ['m', 'p', 's', 'z']) {\n    var bingpai = shoupai._bingpai[s]\n    for (var n = 1; n < bingpai.length; n++) {\n      if (bingpai[n] >= 4) continue\n      bingpai[n]++\n      if (xiangting(shoupai) < n_xiangting) pai.push(s + n)\n      bingpai[n]--\n    }\n  }\n\n  return pai\n}\n\n\n//# sourceURL=webpack:///./js/util/xiangting.js?");

/***/ })

/******/ });